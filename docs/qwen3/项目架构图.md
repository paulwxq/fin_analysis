# Qwen3 Chat Client - é¡¹ç›®æ¶æ„å›¾

## æ•´ä½“æ¶æ„è§†å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    MAF (Microsoft Agent Framework)               â”‚
â”‚                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚  ChatAgent   â”‚â”€â”€â”€â–¶â”‚ BaseChatClientâ”‚â—€â”€â”€â”€â”‚ OpenAIClient â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚                             â–²                                    â”‚
â”‚                             â”‚ å®ç°åè®®                           â”‚
â”‚                             â”‚                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â”‚ è‡ªå®šä¹‰å®ç°
                              â–¼
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚      Qwen3 Chat Client Package         â”‚
         â”‚                                         â”‚
         â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
         â”‚  â”‚   QwenChatClient                 â”‚  â”‚ æ¨ç†æ¨¡å‹
         â”‚  â”‚   - qwen-plus                    â”‚  â”‚
         â”‚  â”‚   - qwen-max                     â”‚  â”‚
         â”‚  â”‚   - enable_thinking              â”‚  â”‚
         â”‚  â”‚   - enable_search                â”‚  â”‚
         â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
         â”‚               â”‚                         â”‚
         â”‚               â”‚ è°ƒç”¨                    â”‚
         â”‚               â–¼                         â”‚
         â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
         â”‚  â”‚   dashscope.Generation           â”‚  â”‚
         â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
         â”‚                                         â”‚
         â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
         â”‚  â”‚   QwenVLChatClient               â”‚  â”‚ è§†è§‰æ¨¡å‹
         â”‚  â”‚   - qwen3-vl-plus                â”‚  â”‚
         â”‚  â”‚   - qwen-vl-max                  â”‚  â”‚
         â”‚  â”‚   - å¤šæ¨¡æ€æ”¯æŒ                    â”‚  â”‚
         â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
         â”‚               â”‚                         â”‚
         â”‚               â”‚ è°ƒç”¨                    â”‚
         â”‚               â–¼                         â”‚
         â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
         â”‚  â”‚   dashscope.MultiModalConv       â”‚  â”‚
         â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â”‚ HTTP/HTTPS
                         â–¼
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚    é˜¿é‡Œäº‘DashScope APIæœåŠ¡å™¨            â”‚
         â”‚                                         â”‚
         â”‚  - æ–‡æœ¬ç”Ÿæˆé›†ç¾¤ (qwen-plus/max)        â”‚
         â”‚  - è§†è§‰ç†è§£é›†ç¾¤ (qwen3-vl-plus)        â”‚
         â”‚  - è”ç½‘æœç´¢æœåŠ¡                         â”‚
         â”‚  - æ€è€ƒæ¨¡å¼æ¨ç†                         â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## æ•°æ®æµå›¾ - æ¨ç†æ¨¡å‹ (qwen-plus)

### æµå¼å“åº”æµç¨‹

```
ç”¨æˆ· â†’ ChatAgent
         â”‚
         â”‚ run_stream(query, options)
         â–¼
    QwenChatClient._inner_get_streaming_response()
         â”‚
         â”œâ”€ 1. è½¬æ¢æ¶ˆæ¯æ ¼å¼
         â”‚   MAF ChatMessage â†’ DashScopeæ ¼å¼
         â”‚   {"role": "user", "content": "..."}
         â”‚
         â”œâ”€ 2. æ„å»ºè¯·æ±‚å‚æ•°
         â”‚   {
         â”‚     model: "qwen-plus",
         â”‚     stream: True,
         â”‚     incremental_output: True,  ğŸ”¥ å¼ºåˆ¶
         â”‚     enable_thinking: True,
         â”‚     enable_search: True
         â”‚   }
         â”‚
         â”œâ”€ 3. å¯åŠ¨çº¿ç¨‹æ± ç”Ÿäº§è€…
         â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚   â”‚  åŒæ­¥çº¿ç¨‹ä¸­              â”‚
         â”‚   â”‚  dashscope.Generation    â”‚
         â”‚   â”‚  .call(stream=True)      â”‚
         â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚          â”‚
         â”‚          â”‚ é€chunkè¿”å›
         â”‚          â–¼
         â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚   â”‚  asyncio.Queue           â”‚
         â”‚   â”‚  - chunk 1               â”‚
         â”‚   â”‚  - chunk 2               â”‚
         â”‚   â”‚  - ...                   â”‚
         â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚          â”‚
         â”œâ”€ 4. å¼‚æ­¥æ¶ˆè´¹è€…å¾ªç¯
         â”‚   while True:
         â”‚       chunk = await queue.get()
         â”‚
         â”‚       if hasattr(chunk, 'reasoning_content'):
         â”‚           ğŸ”¥ æ€è€ƒè¿‡ç¨‹
         â”‚           [å¯é€‰è¿”å›ç»™ç”¨æˆ·]
         â”‚
         â”‚       if chunk.delta.content:
         â”‚           âœ… æœ€ç»ˆç­”æ¡ˆ
         â”‚           yield ChatResponseUpdate(...)
         â”‚
         â””â”€ 5. è¿”å›ç»™ç”¨æˆ·
             ChatAgent â†’ ç”¨æˆ·çœ‹åˆ°å®æ—¶æµå¼è¾“å‡º
```

---

## æ•°æ®æµå›¾ - è§†è§‰æ¨¡å‹ (qwen3-vl-plus)

### å¤šæ¨¡æ€æ¶ˆæ¯è½¬æ¢

```
ç”¨æˆ·æä¾›:
  ChatMessage(
    role=USER,
    contents=[
      TextContent("åˆ†æKçº¿å›¾"),
      ImageContent(url="https://...")
    ]
  )
         â”‚
         â”‚ QwenVLChatClient._convert_messages()
         â–¼
  éå† contents:
         â”‚
         â”œâ”€ TextContent
         â”‚   â†’ {"text": "åˆ†æKçº¿å›¾"}
         â”‚
         â”œâ”€ ImageContent
         â”‚   â”‚
         â”‚   â”œâ”€ æ£€æµ‹ url å±æ€§
         â”‚   â”‚   â†’ {"image": "https://..."}
         â”‚   â”‚
         â”‚   â””â”€ æ£€æµ‹ data å±æ€§ (Base64)
         â”‚       â†’ {"image": "data:image/png;base64,iVBOR..."}
         â”‚
         â””â”€ å…œåº•å¤„ç† (Text)

æœ€ç»ˆè¾“å‡º:
  {
    "role": "user",
    "content": [
      {"text": "åˆ†æKçº¿å›¾"},
      {"image": "https://..."}
    ]
  }
         â”‚
         â”‚ å‘é€åˆ° MultiModalConversation.call()
         â–¼
  DashScopeè§†è§‰æ¨¡å‹
         â”‚
         â”‚ è¿”å›åˆ†æç»“æœ
         â–¼
  {"role": "assistant", "content": "è¿™æ˜¯ä¸€ä¸ª..."}
         â”‚
         â”‚ è½¬æ¢å›MAFæ ¼å¼
         â–¼
  ChatResponse(
    messages=[
      ChatMessage(
        role=ASSISTANT,
        contents=[TextContent(text="è¿™æ˜¯ä¸€ä¸ª...")]
      )
    ]
  )
```

---

## ç±»ç»§æ‰¿å…³ç³»å›¾

```
agent_framework.BaseChatClient (MAFæ ¸å¿ƒ)
         â–²
         â”‚ ç»§æ‰¿
         â”‚
         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚                 â”‚                 â”‚
  QwenChatClient    QwenVLChatClient   (å…¶ä»–Client)
  (æ–‡æœ¬æ¨ç†)         (è§†è§‰ç†è§£)
         â”‚                 â”‚
         â”‚                 â”‚
    å®ç°æ–¹æ³•:           å®ç°æ–¹æ³•:
    - __init__          - __init__
    - _convert_messages - _convert_messages
                        - _process_content_item ğŸ”¥ ç‹¬æœ‰
    - _build_params     - _build_params
    - get_response      - get_response
    - get_streaming     - get_streaming
```

---

## é…ç½®ç±»å‹å±‚æ¬¡

```
typing.TypedDict
         â–²
         â”‚
agent_framework.ChatOptions (MAFæ ‡å‡†)
  - temperature: float
  - top_p: float
  - max_tokens: int
         â–²
         â”‚ æ‰©å±•
         â”‚
         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚                 â”‚                 â”‚
  QwenChatOptions    QwenVLChatOptions
  (æ¨ç†æ¨¡å‹é…ç½®)      (è§†è§‰æ¨¡å‹é…ç½®)
         â”‚                 â”‚
    + enable_thinking   + min_pixels
    + enable_search     (ä¸æ”¯æŒenable_search)
    + seed
    + repetition_penalty
```

---

## å¼‚æ­¥æ‰§è¡Œæµç¨‹

### é—®é¢˜: DashScope SDKæ˜¯åŒæ­¥çš„

```
DashScope SDK åŒæ­¥è°ƒç”¨:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Generation.call()     â”‚ â† é˜»å¡ä¸»çº¿ç¨‹
â”‚  è¿”å›: ç”Ÿæˆå™¨           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### è§£å†³æ–¹æ¡ˆ: çº¿ç¨‹æ± å¼‚æ­¥é€‚é…

```
MAF å¼‚æ­¥äº‹ä»¶å¾ªç¯ (ä¸»çº¿ç¨‹)
         â”‚
         â”‚ await get_streaming_response()
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  asyncio.Queue (æ¡¥æ¢)              â”‚
â”‚  - çº¿ç¨‹å®‰å…¨                         â”‚
â”‚  - å¼‚æ­¥get/put                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â–²                â”‚
         â”‚ put_nowait     â”‚ await get()
         â”‚                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  åå°çº¿ç¨‹      â”‚  â”‚  ä¸»çº¿ç¨‹        â”‚
â”‚                â”‚  â”‚  (asyncio)     â”‚
â”‚  åŒæ­¥ç”Ÿæˆå™¨    â”‚  â”‚  å¼‚æ­¥æ¶ˆè´¹è€…    â”‚
â”‚  for chunk in  â”‚  â”‚  while True:   â”‚
â”‚    sdk.call()  â”‚  â”‚    chunk =     â”‚
â”‚      yieldâ”€â”€â”€â”€â”€â”¼â”€â”€â”¼â”€â”€â–¶await get()  â”‚
â”‚                â”‚  â”‚    yieldâ”€â”€â”€â”€â”€â”€â”€â”¼â”€â–¶ ç”¨æˆ·
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**å…³é”®ä»£ç **:
```python
loop = asyncio.get_running_loop()
queue = asyncio.Queue()

def _producer():
    for resp in dashscope.Generation.call(stream=True, ...):
        loop.call_soon_threadsafe(queue.put_nowait, resp)

threading.Thread(target=_producer, daemon=True).start()

while True:
    item = await queue.get()
    yield ChatResponseUpdate(...)
```

---

## æ€è€ƒæ¨¡å¼å¤„ç†æµç¨‹

### DashScopeå“åº”ç»“æ„

```json
// æµå¼è¿”å›çš„æ¯ä¸ªchunk
{
  "output": {
    "choices": [{
      "message": {
        "reasoning_content": "è®©æˆ‘åˆ†æä¸€ä¸‹...",  // ğŸ”¥ æ€è€ƒè¿‡ç¨‹
        "content": "ç­”æ¡ˆæ˜¯..."                    // âœ… æœ€ç»ˆç­”æ¡ˆ
      },
      "finish_reason": null
    }]
  },
  "usage": {
    "input_tokens": 100,
    "output_tokens": 50,
    "reasoning_tokens": 500  // ğŸ”¥ æ€è€ƒToken
  }
}
```

### å¤„ç†é€»è¾‘

```python
for chunk in stream:
    delta = chunk.output.choices[0].message

    # 1. å¤„ç†æ€è€ƒå†…å®¹
    if hasattr(delta, 'reasoning_content') and delta.reasoning_content:
        thinking_tokens += len(delta.reasoning_content) // 4

        if include_reasoning:  # ç”¨æˆ·é…ç½®
            # ğŸ”¥ è¿”å›ç»™ç”¨æˆ·ï¼ˆåŒ…è£…åœ¨æ ‡ç­¾ä¸­ï¼‰
            yield ChatResponseUpdate(
                content=f"<thinking>{delta.reasoning_content}</thinking>"
            )
        else:
            # é™é»˜ä¸¢å¼ƒï¼ˆç”¨æˆ·å·²ä»˜è´¹ä½†ä¸æƒ³çœ‹ï¼‰
            pass

    # 2. å¤„ç†æœ€ç»ˆç­”æ¡ˆ
    if delta.content:
        output_tokens += len(delta.content) // 4
        yield ChatResponseUpdate(
            content=delta.content  # âœ… æ™®é€šè¾“å‡º
        )
```

---

## é”™è¯¯å¤„ç†æµç¨‹

```
ç”¨æˆ·è¯·æ±‚
    â”‚
    â–¼
QwenChatClient
    â”‚
    â”œâ”€ å‚æ•°éªŒè¯
    â”‚   â”œâ”€ enable_thinking + éæµå¼? â†’ ThinkingModeRequiresStreamError
    â”‚   â””â”€ æ— API Key? â†’ ValueError
    â”‚
    â”œâ”€ APIè°ƒç”¨
    â”‚   â”‚
    â”‚   â”œâ”€ HTTP 400 â†’ QwenAPIError
    â”‚   â”‚   (å‚æ•°é”™è¯¯ï¼Œä¸å¯é‡è¯•)
    â”‚   â”‚
    â”‚   â”œâ”€ HTTP 429 â†’ RateLimitError
    â”‚   â”‚   (é™æµï¼Œå¯é‡è¯• + æŒ‡æ•°é€€é¿)
    â”‚   â”‚
    â”‚   â”œâ”€ HTTP 500 â†’ QwenAPIError
    â”‚   â”‚   (æœåŠ¡å™¨é”™è¯¯ï¼Œå¯é‡è¯•)
    â”‚   â”‚
    â”‚   â””â”€ NetworkError â†’ ConnectionError
    â”‚       (ç½‘ç»œé”™è¯¯ï¼Œå¯é‡è¯•)
    â”‚
    â””â”€ å“åº”å¤„ç†
        â”œâ”€ status_code != 200 â†’ RuntimeError
        â”œâ”€ è§£æå¤±è´¥ â†’ JSONDecodeError
        â””â”€ æˆåŠŸ â†’ è¿”å›ç»“æœ
```

---

## æ–‡ä»¶ä¾èµ–å…³ç³»å›¾

```
qwen_options.py (æ— ä¾èµ–)
    â–²
    â”‚ å¯¼å…¥
    â”‚
exceptions.py (æ— ä¾èµ–)
    â–²
    â”‚ å¯¼å…¥
    â”‚
utils.py
    â”‚ ä¾èµ–: agent_framework
    â–²
    â”‚ å¯¼å…¥
    â”‚
qwen_client.py
    â”‚ ä¾èµ–:
    â”‚   - agent_framework (BaseChatClientç­‰)
    â”‚   - dashscope (Generation)
    â”‚   - qwen_options
    â”‚   - exceptions
    â”‚   - utils
    â–²
    â”‚
qwen_vl_client.py
    â”‚ ä¾èµ–:
    â”‚   - agent_framework
    â”‚   - dashscope (MultiModalConversation)
    â”‚   - qwen_options
    â”‚   - exceptions
    â”‚   - utils
    â–²
    â”‚ å¯¼å…¥
    â”‚
__init__.py (å¯¼å‡ºæ‰€æœ‰å…¬å¼€API)
```

---

## æµ‹è¯•æ¶æ„

```
pytestæ¡†æ¶
    â”‚
    â”œâ”€ tests/test_qwen_client.py
    â”‚   â”œâ”€ å•å…ƒæµ‹è¯• (Mock DashScope API)
    â”‚   â”œâ”€ é›†æˆæµ‹è¯• (çœŸå®APIè°ƒç”¨)
    â”‚   â””â”€ æ€§èƒ½æµ‹è¯• (å¹¶å‘/å»¶è¿Ÿ)
    â”‚
    â”œâ”€ tests/test_qwen_vl_client.py
    â”‚   â”œâ”€ å¤šæ¨¡æ€è½¬æ¢æµ‹è¯•
    â”‚   â”œâ”€ å›¾ç‰‡æ ¼å¼æµ‹è¯•
    â”‚   â””â”€ çº¯æ–‡æœ¬é™çº§æµ‹è¯•
    â”‚
    â””â”€ tests/test_integration.py
        â”œâ”€ ä¸ChatAgenté›†æˆ
        â”œâ”€ ä¸­é—´ä»¶æµ‹è¯•
        â””â”€ å¤šè½®å¯¹è¯æµ‹è¯•

è¦†ç›–ç‡ç›®æ ‡: > 80%
```

---

## éƒ¨ç½²æ¶æ„ (ç”Ÿäº§ç¯å¢ƒ)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   åº”ç”¨æœåŠ¡å™¨                           â”‚
â”‚                                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  MAF Agent åº”ç”¨                                 â”‚  â”‚
â”‚  â”‚                                                  â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚  â”‚
â”‚  â”‚  â”‚ Agent 1  â”‚  â”‚ Agent 2  â”‚  â”‚ Agent 3  â”‚     â”‚  â”‚
â”‚  â”‚  â”‚ (æ¨ç†)   â”‚  â”‚ (è§†è§‰)   â”‚  â”‚ (æ··åˆ)   â”‚     â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚  â”‚
â”‚  â”‚       â–²              â–²              â–²          â”‚  â”‚
â”‚  â”‚       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚  â”‚
â”‚  â”‚                      â”‚                         â”‚  â”‚
â”‚  â”‚          Qwen3 Chat Client Package            â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                         â”‚                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                          â”‚ HTTPS
                          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              ä¸­é—´ä»¶å±‚                                  â”‚
â”‚                                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  æ—¥å¿—ä¸­é—´ä»¶  â”‚  â”‚  é™æµä¸­é—´ä»¶  â”‚  â”‚  ç›‘æ§     â”‚   â”‚
â”‚  â”‚  (Logging)   â”‚  â”‚  (RateLimit) â”‚  â”‚ (Metrics) â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                          â”‚
                          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           é˜¿é‡Œäº‘DashScope API                          â”‚
â”‚                                                        â”‚
â”‚  - é«˜å¯ç”¨é›†ç¾¤                                          â”‚
â”‚  - è‡ªåŠ¨æ‰©ç¼©å®¹                                          â”‚
â”‚  - å…¨çƒCDNåŠ é€Ÿ                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## å…³é”®æŒ‡æ ‡ç›‘æ§

```
Prometheus + Grafana

Metrics:
  - qwen_requests_total (è®¡æ•°)
  - qwen_request_duration_seconds (å»¶è¿Ÿ)
  - qwen_tokens_total (Tokenæ¶ˆè€—)
  - qwen_thinking_tokens_ratio (æ€è€ƒ/ç­”æ¡ˆæ¯”ä¾‹)
  - qwen_errors_total (é”™è¯¯ç‡)

Alerts:
  - é™æµé¢‘ç¹ â†’ æ‰©å®¹å»ºè®®
  - é”™è¯¯ç‡ > 5% â†’ ç´§æ€¥å‘Šè­¦
```

---

**æœ€åæ›´æ–°**: 2026-01-29
**æ–‡æ¡£ç‰ˆæœ¬**: v1.0
