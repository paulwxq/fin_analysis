这是用户流程中最具创新性的部分。传统的量化仅依赖数字，而“形态”往往包含数字难以捕捉的视觉特征（Gestalt）。用户提议使用ChatGPT读取月K线图，这实际上是利用\*\*视觉-语言模型（VLM）\*\*进行图像分类和推理3。

### **5.1 可视化模块（Visualization Module）的标准化**

为了让AI能准确判断，生成的K线图必须去除噪音，突出特征。

#### **5.1.1 绘图规范**

1. **时间跨度**：必须包含足够长的历史数据。建议绘制过去5-8年的月线图。左侧显示高耸的历史头部，中间显示漫长的下跌，右侧显示低位的横盘。这种视觉反差是判断“曾经辉煌”和“深度回调”的关键。  
2. **技术指标叠加**：  
   * **30月均线（MA30）**：这是斯坦·温斯坦（Stan Weinstein）阶段分析的核心指标11。AI需要判断股价是否站上MA30，以及MA30是否走平上翘。  
   * **成交量柱**：底部必须伴随成交量的极度萎缩（地量），以及上涨时的脉冲式放量（吸筹）。  
   * **支撑线**：程序自动计算最近3年的最低点，并在图上画出一条水平支撑线。这有助于AI判断股价是否“坐稳”在支撑线上。  
3. **图像预处理**：去除网格线，使用高对比度的配色（如红涨绿跌，背景全白），确保图像尺寸统一（如1024x768），以便LLM的ViT（Vision Transformer）编码器处理。

### **5.2 视觉模型选型：GPT-4o vs. 专用CNN**

用户提到了使用ChatGPT。目前的GPT-4o（Omni）具备极强的多模态能力，非常适合此类任务。相比传统的卷积神经网络（CNN），GPT-4o不仅能分类（是否为底），还能给出**解释性推理**（为什么是底），这对于辅助决策至关重要。

**对比分析表：**

| 特性         | GPT-4o (VLM)                  | 传统 CNN (ResNet/EfficientNet)     |
| :----------- | :---------------------------- | :--------------------------------- |
| **训练成本** | 零样本（Zero-shot），无需训练 | 需大量标注数据（Labeling）进行训练 |
| **推理能力** | 强，能结合图中文本和形态逻辑  | 弱，仅输出概率值                   |
| **泛化能力** | 强，能识别未见过的变体        | 弱，对未见过的形态容易误判         |
| **运行成本** | 较高（API调用费）             | 极低（本地显卡推理）               |
| **适用场景** | **少量精选标的的高级审核**    | 海量数据的初步过滤                 |

**建议策略**：鉴于API成本和速度，建议采用“漏斗式”设计。前述的SQL+Python步骤作为第一层过滤器，将5000只股票筛选至50-100只“高潜力候选”。然后仅对这50-100张图表调用GPT-4o进行视觉评分。

### **5.3 Prompt Engineering：视觉识别提示词设计**

为了让ChatGPT准确识别“平底锅”形态，Prompt的设计至关重要。我们需要将交易员的视觉经验转化为文字指令。

**系统提示词（System Prompt）设计草案：**

**Role**: 你是一位拥有20年经验的华尔街技术分析师，精通威科夫操盘法（Wyckoff Method）和斯坦·温斯坦的阶段分析理论（Stage Analysis）。

**Task**: 分析上传的A股月线K线图，判断该股票是否符合“长期超跌后的底部沉淀”（Stage 1 Base）形态。

**Evaluation Criteria (评分标准 0-10分)**:

1. **Left Side (曾经辉煌与暴跌)**: 图表左侧是否有明显的历史高点，随后经历了深幅下跌（跌幅\>50%）？如果没有深幅下跌，得分为0。  
2. **Base Formation (底部结构)**: 右侧是否形成了一个长期的、扁平的箱体？箱体持续时间是否超过12个月？  
3. **Volatility Contraction (波动收敛)**: 箱体内的K线实体是否越来越短？是否存在上下影线刺探支撑但未破位的行为？  
4. **Moving Average (均线行为)**: 股价是否已经站上30月均线？30月均线是否已经由跌转平，甚至微幅上翘？  
5. **Volume (量能行为)**: 下跌时是否缩量？箱体震荡期间是否有间歇性的放量阳线（Pocket Pivots）？

**Output Format**: 请以JSON格式输出，包含以下字段：

* score: (0-10)  
* pattern\_name: (如 "Classic Pan Bottom", "V-Shape", "Descending Triangle", "Messy")  
* reasoning: (200字以内的形态分析)  
* stage: ("Stage 4 Decline", "Stage 1 Base", "Stage 2 Breakout")

通过这种结构化的Prompt，我们可以将非结构化的图像信息转化为结构化的数据存入数据库。

