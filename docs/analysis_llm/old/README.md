# analysis_llm æ¨¡å—æ–‡æ¡£

## ğŸ“š æ–‡æ¡£è¯´æ˜

æœ¬ç›®å½•åŒ…å« `analysis_llm` æ¨¡å—çš„å®Œæ•´è®¾è®¡æ–‡æ¡£å’Œå‚è€ƒèµ„æ–™ã€‚

## ğŸ“„ æ–‡æ¡£æ¸…å•

### æ ¸å¿ƒæ–‡æ¡£

- **[æ¦‚è¦è®¾è®¡æ–‡æ¡£.md](./æ¦‚è¦è®¾è®¡æ–‡æ¡£.md)** â­
  - å®Œæ•´çš„ç³»ç»Ÿè®¾è®¡æ–‡æ¡£
  - åŸºäº MAF python-1.0.0b260130ï¼ˆæœ€æ–°ç‰ˆæœ¬ï¼‰
  - åŒ…å« Agent æ¶æ„ã€æ•°æ®åº“è®¾è®¡ã€éƒ¨ç½²æŒ‡å—
  - **å»ºè®®é¦–å…ˆé˜…è¯»æ­¤æ–‡æ¡£**

### å‚è€ƒèµ„æ–™

- **[reference/stock_analysis_magentic_design.md](./reference/stock_analysis_magentic_design.md)**
  - åŸºäº MAF python-1.0.0b260128 çš„åŸå§‹è®¾è®¡
  - æä¾›è®¾è®¡æ€è·¯å’Œä»£ç ç¤ºä¾‹
  - ä½œä¸ºæœ¬è®¾è®¡çš„å‚è€ƒåŸºç¡€

- **[reference/README.md](./reference/README.md)**
  - å‚è€ƒè®¾è®¡çš„é¡¹ç›®è¯´æ˜
  - åŠŸèƒ½ç‰¹æ€§ä»‹ç»

- **[reference/QUICKSTART.md](./reference/QUICKSTART.md)**
  - å‚è€ƒè®¾è®¡çš„å¿«é€Ÿå¼€å§‹æŒ‡å—
  - å®‰è£…å’Œä½¿ç”¨ç¤ºä¾‹

## ğŸ¯ é˜…è¯»é¡ºåºå»ºè®®

å¦‚æœä½ æ˜¯ç¬¬ä¸€æ¬¡æ¥è§¦æœ¬é¡¹ç›®ï¼Œå»ºè®®æŒ‰ä»¥ä¸‹é¡ºåºé˜…è¯»ï¼š

1. **[æ¦‚è¦è®¾è®¡æ–‡æ¡£.md](./æ¦‚è¦è®¾è®¡æ–‡æ¡£.md)** - äº†è§£æ•´ä½“æ¶æ„å’Œè®¾è®¡æ€è·¯
2. **[reference/stock_analysis_magentic_design.md](./reference/stock_analysis_magentic_design.md)** - å‚è€ƒåŸå§‹è®¾è®¡
3. **[reference/QUICKSTART.md](./reference/QUICKSTART.md)** - äº†è§£åŸºæœ¬ä½¿ç”¨æµç¨‹

## ğŸ”‘ æ ¸å¿ƒè®¾è®¡è¦ç‚¹

### 1. æŠ€æœ¯æ ˆ
- **æ¡†æ¶**: Microsoft Agent Framework (python-1.0.0b260130)
- **ç¼–æ’æ¨¡å¼**: Magenticï¼ˆManager + 5 ä¸ª Worker Agentsï¼‰
- **æ•°æ®åº“**: PostgreSQL
- **LLM**: OpenAI GPT-4oï¼ˆæ¨èï¼‰æˆ– DashScopeï¼ˆé˜¿é‡Œäº‘ï¼‰
- **Web Search**: Tavily APIï¼ˆæ¨èï¼‰æˆ– Google Custom Search

### 2. Agent æ¶æ„
```
StockAnalysisManager (Manager Agent)
â”œâ”€â”€ StockDataAgentï¼ˆæ•°æ®è·å–ä¸“å®¶ï¼‰
â”œâ”€â”€ SectorResearchAgentï¼ˆæ¿å—ç ”ç©¶ä¸“å®¶ï¼‰
â”œâ”€â”€ CompanyResearchAgentï¼ˆå…¬å¸ç ”ç©¶ä¸“å®¶ï¼‰
â”œâ”€â”€ TechnicalAnalystAgentï¼ˆæŠ€æœ¯åˆ†æä¸“å®¶ï¼‰
â””â”€â”€ ReportWriterAgentï¼ˆæŠ¥å‘Šæ’°å†™ä¸“å®¶ï¼‰
```

### 3. æ ¸å¿ƒåŠŸèƒ½
- âœ… è‡ªåŠ¨åˆ†æ"å¹³åº•é”…"å½¢æ€è‚¡ç¥¨
- âœ… Web Search è·å–æœ€æ–°æ¿å—çƒ­åº¦å’Œå…¬å¸åŠ¨æ€
- âœ… ä¸‰ç»´è¯„åˆ†ï¼ˆæ¿å— 35% + å…¬å¸ 35% + æŠ€æœ¯ 30%ï¼‰
- âœ… ç”Ÿæˆç»“æ„åŒ– Markdown æŠ¥å‘Š
- âœ… ç»“æœå­˜å…¥ PostgreSQL æ•°æ®åº“

### 4. æ•°æ®æµ
```
stock_flatbottom_preselectï¼ˆè¾“å…¥ï¼‰
    â†“
StockAnalysisManager
    â†“
5 ä¸ª Worker Agentsï¼ˆå¹¶è¡Œåˆ†æï¼‰
    â†“
ReportWriterAgentï¼ˆç»¼åˆï¼‰
    â†“
stock_analysis_resultsï¼ˆè¾“å‡ºï¼‰
```

## ğŸ“¦ æ–‡ä»¶ç»“æ„è§„åˆ’

æ ¹æ®è®¾è®¡æ–‡æ¡£ï¼Œ`analysis_llm/` æ¨¡å—çš„æ–‡ä»¶ç»“æ„å¦‚ä¸‹ï¼š

```
analysis_llm/
â”œâ”€â”€ __init__.py
â”œâ”€â”€ __main__.py                       # CLI å…¥å£
â”œâ”€â”€ config.py                         # é…ç½®ç®¡ç†
â”œâ”€â”€ analyzer.py                       # StockAnalyzer ä¸»ç±»
â”œâ”€â”€ agents/                           # Agent å®šä¹‰
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ manager.py
â”‚   â”œâ”€â”€ stock_data_agent.py
â”‚   â”œâ”€â”€ sector_research_agent.py
â”‚   â”œâ”€â”€ company_research_agent.py
â”‚   â”œâ”€â”€ technical_analyst_agent.py
â”‚   â””â”€â”€ report_writer_agent.py
â”œâ”€â”€ tools/                            # å·¥å…·å‡½æ•°
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ database_tools.py
â”‚   â”œâ”€â”€ web_search_tools.py
â”‚   â”œâ”€â”€ technical_tools.py
â”‚   â””â”€â”€ vision_tools.py
â”œâ”€â”€ models/                           # æ•°æ®æ¨¡å‹
â”‚   â”œâ”€â”€ __init__.py
â”‚   â””â”€â”€ schemas.py
â”œâ”€â”€ database/                         # æ•°æ®åº“æ“ä½œ
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ connection.py
â”‚   â”œâ”€â”€ queries.py
â”‚   â””â”€â”€ init_db.py
â””â”€â”€ utils/                            # å·¥å…·ç±»
    â”œâ”€â”€ __init__.py
    â”œâ”€â”€ logger.py
    â””â”€â”€ prompts.py
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. å®‰è£…ä¾èµ–
```bash
cd /opt/fin_analysis
source .venv/bin/activate
pip install agent-framework==1.0.0b260130
pip install asyncpg pandas numpy pillow httpx python-dotenv pydantic
```

### 2. é…ç½®ç¯å¢ƒå˜é‡
```bash
# å¤åˆ¶ç¯å¢ƒå˜é‡æ¨¡æ¿ï¼ˆå‚è€ƒ æ¦‚è¦è®¾è®¡æ–‡æ¡£.md ç¬¬ 7.1 èŠ‚ï¼‰
cp .env.sample .env
vim .env  # å¡«å†™ API Key å’Œæ•°æ®åº“é…ç½®
```

### 3. åˆå§‹åŒ–æ•°æ®åº“
```bash
python -m analysis_llm.database.init_db
```

### 4. åˆ†æè‚¡ç¥¨
```bash
# åˆ†æå•æ”¯è‚¡ç¥¨
python -m analysis_llm 600000.SH

# æ‰¹é‡åˆ†æ
python scripts/batch_analyze.py
```

## ğŸ“Š è¾“å‡ºç¤ºä¾‹

åˆ†æç»“æœåŒ…æ‹¬ï¼š

1. **æ§åˆ¶å°å®æ—¶è¾“å‡º**ï¼šæ˜¾ç¤ºå„ Agent çš„å·¥ä½œè¿›åº¦
2. **Markdown æŠ¥å‘Š**ï¼šç»“æ„åŒ–åˆ†ææŠ¥å‘Šï¼ˆåŸºæœ¬ä¿¡æ¯ã€æ¿å—åˆ†æã€å…¬å¸åˆ†æã€æŠ€æœ¯åˆ†æã€ç»¼åˆè¯„ä¼°ï¼‰
3. **æ•°æ®åº“è®°å½•**ï¼šè¯„åˆ†ã€ç†ç”±ã€è¯¦ç»†æ•°æ®ï¼ˆJSONBï¼‰

**ç»¼åˆè¯„åˆ†**ï¼š0-10 åˆ†
- **7.5+ å¼ºçƒˆæ¨è**
- **6.0-7.5 è°¨æ…æ¨è**
- **4.0-6.0 ä¸­æ€§**
- **<4.0 ä¸æ¨è**

## ğŸ”§ é…ç½®è¯´æ˜

### ç¯å¢ƒå˜é‡ï¼ˆ.envï¼‰

æ ¸å¿ƒé…ç½®é¡¹ï¼š

```bash
# æ•°æ®åº“
DB_HOST=172.29.128.1
DB_NAME=fin_db
DB_USER=postgres
DB_PASS=your_password

# LLMï¼ˆOpenAIï¼‰
OPENAI_API_KEY=sk-your-key
LLM_MODEL_MANAGER=gpt-4o           # Manager ä½¿ç”¨å¼ºæ¨¡å‹
LLM_MODEL_WORKER=gpt-4o-mini       # Worker ä½¿ç”¨è½»é‡æ¨¡å‹

# Web Search
TAVILY_API_KEY=your_tavily_key     # æ¨è

# Magentic
MAX_STALL_COUNT=3                  # æœ€å¤§åœæ»æ¬¡æ•°
ENABLE_PLAN_REVIEW=true            # å¯ç”¨è®¡åˆ’å®¡æŸ¥
AUTO_APPROVE_PLAN=false            # è‡ªåŠ¨æ‰¹å‡†è®¡åˆ’
```

è¯¦ç»†é…ç½®è¯´æ˜å‚è§ **[æ¦‚è¦è®¾è®¡æ–‡æ¡£.md ç¬¬ 7 èŠ‚](./æ¦‚è¦è®¾è®¡æ–‡æ¡£.md#7-é…ç½®ç®¡ç†)**

## ğŸ†š ä¸å‚è€ƒè®¾è®¡çš„å¯¹æ¯”

| ç»´åº¦ | å‚è€ƒè®¾è®¡ | æœ¬è®¾è®¡ |
|------|---------|--------|
| MAF ç‰ˆæœ¬ | python-1.0.0b260128 | **python-1.0.0b260130**ï¼ˆæœ€æ–°ï¼‰ |
| ç±»å‹æç¤º | åŸºç¡€ | **æ³›å‹æ”¯æŒ** |
| æ•°æ®åº“ | ç®€å•ç¤ºä¾‹ | **å®Œæ•´ DatabaseManager** |
| Web Search | ç¤ºä¾‹ | **å®Œæ•´ Tavily å°è£…** |
| è¯„åˆ†ç®—æ³• | ç®€å•åŠ æƒ | **ä¸‰ç»´è¯„åˆ†**ï¼ˆæ¿å—+å…¬å¸+æŠ€æœ¯ï¼‰ |
| æ•°æ®å­˜å‚¨ | è¯„åˆ†+ç†ç”± | **JSONB è¯¦ç»†æ•°æ®** + Markdown |

è¯¦è§ **[æ¦‚è¦è®¾è®¡æ–‡æ¡£.md ç¬¬ 9 èŠ‚](./æ¦‚è¦è®¾è®¡æ–‡æ¡£.md#9-ä¸å‚è€ƒè®¾è®¡çš„å¯¹æ¯”å’Œæ”¹è¿›)**

## ğŸ“ å¾…åŠäº‹é¡¹

- [ ] å®ç° `analysis_llm/` æ¨¡å—ä»£ç 
- [ ] ç¼–å†™å•å…ƒæµ‹è¯•
- [ ] ç¼–å†™é›†æˆæµ‹è¯•
- [ ] ç«¯åˆ°ç«¯æµ‹è¯•ï¼ˆåˆ†æçœŸå®è‚¡ç¥¨ï¼‰
- [ ] æ€§èƒ½ä¼˜åŒ–ï¼ˆç¼“å­˜ã€å¹¶å‘ï¼‰
- [ ] ç¼–å†™ API æ–‡æ¡£
- [ ] ç¼–å†™éƒ¨ç½²æŒ‡å—
- [ ] Docker å®¹å™¨åŒ–

## ğŸ¤ è´¡çŒ®æŒ‡å—

å¦‚éœ€ä¿®æ”¹æˆ–æ‰©å±•æœ¬æ¨¡å—ï¼Œè¯·å‚è€ƒï¼š

1. **æ¶æ„è®¾è®¡**ï¼šéµå¾ª Magentic ç¼–æ’æ¨¡å¼
2. **Agent è®¾è®¡**ï¼šå•ä¸€èŒè´£ï¼Œæ¸…æ™°çš„ System Message
3. **å·¥å…·å‡½æ•°**ï¼šå¼‚æ­¥å‡½æ•°ï¼Œå®Œæ•´çš„ç±»å‹æç¤º
4. **é”™è¯¯å¤„ç†**ï¼šä¼˜é›…é™çº§ï¼Œè®°å½•æ—¥å¿—
5. **æµ‹è¯•**ï¼šç¼–å†™å•å…ƒæµ‹è¯•å’Œé›†æˆæµ‹è¯•

## ğŸ“§ è”ç³»æ–¹å¼

å¦‚æœ‰é—®é¢˜æˆ–å»ºè®®ï¼Œè¯·ï¼š
- æŸ¥é˜… [æ¦‚è¦è®¾è®¡æ–‡æ¡£.md](./æ¦‚è¦è®¾è®¡æ–‡æ¡£.md)
- æäº¤ Issue
- è”ç³»é¡¹ç›®ç»´æŠ¤è€…

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0
**æœ€åæ›´æ–°**: 2026-02-02
**ç»´æŠ¤è€…**: å¼€å‘å›¢é˜Ÿ
