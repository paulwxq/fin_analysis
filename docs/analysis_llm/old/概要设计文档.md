# analysis_llm æ¨¡å—æ¦‚è¦è®¾è®¡æ–‡æ¡£

## æ–‡æ¡£ç‰ˆæœ¬ä¿¡æ¯

| ç‰ˆæœ¬ | æ—¥æœŸ | ä½œè€… | å˜æ›´è¯´æ˜ |
|------|------|------|----------|
| v1.0 | 2026-02-02 | Claude | åˆå§‹ç‰ˆæœ¬ï¼ŒåŸºäº MAF python-1.0.0b260130 |

## 1. ç³»ç»Ÿæ¦‚è¿°

### 1.1 ä¸šåŠ¡ç›®æ ‡

ä½¿ç”¨ Microsoft Agent Framework (python-1.0.0b260130) çš„ **Magentic ç¼–æ’æ¨¡å¼**ï¼Œæ„å»ºä¸€ä¸ªæ™ºèƒ½è‚¡ç¥¨æ·±åº¦åˆ†æç³»ç»Ÿã€‚è¯¥ç³»ç»Ÿæ¥æ”¶å‰åºæ¨¡å—ï¼ˆselection/ï¼‰ç­›é€‰å‡ºçš„å…·æœ‰"å¹³åº•é”…"ç‰¹å¾çš„è‚¡ç¥¨ä»£ç ï¼Œé€šè¿‡å¤šä¸ªä¸“å®¶ Agent åä½œï¼Œç»¼åˆåˆ†æè‚¡ç¥¨æ‰€å±æ¿å—ã€è¡Œä¸šè¶‹åŠ¿ã€å…¬å¸åŸºæœ¬é¢ã€æŠ€æœ¯å½¢æ€ç­‰ç»´åº¦ï¼Œæœ€ç»ˆåˆ¤æ–­è¯¥è‚¡ç¥¨åœ¨ **6 ä¸ªæœˆå†…çš„ä¸Šæ¶¨æ½œåŠ›**å’ŒæŠ•èµ„ä»·å€¼ã€‚

**æ ¸å¿ƒä»·å€¼ä¸»å¼ **ï¼š
- è‡ªåŠ¨åŒ–ï¼šæ— éœ€äººå·¥é€ä¸€è°ƒç ”ï¼ŒAgent è‡ªä¸»åä½œå®Œæˆæ·±åº¦åˆ†æ
- å¤šç»´åº¦ï¼šæ¿å—çƒ­åº¦ + å…¬å¸åŸºæœ¬é¢ + æŠ€æœ¯åˆ†æ + å¸‚åœºæƒ…ç»ª
- å®æ—¶æ€§ï¼šé€šè¿‡ Web Search è·å–æœ€æ–°æ–°é—»ã€æ”¿ç­–ã€å¸‚åœºåŠ¨æ€
- å¯è§£é‡Šï¼šç”Ÿæˆç»“æ„åŒ– Markdown æŠ¥å‘Šï¼Œæ˜ç¡®æ¨èç†ç”±å’Œé£é™©æç¤º
- å¯è¿½æº¯ï¼šåˆ†æç»“æœå­˜å…¥æ•°æ®åº“ï¼Œæ”¯æŒå›æµ‹å’ŒæŒç»­ä¼˜åŒ–

### 1.2 è¾“å…¥ä¸è¾“å‡º

**è¾“å…¥**ï¼š
1. **è‚¡ç¥¨ä»£ç **ï¼ˆæ¥è‡ª `stock_flatbottom_preselect` è¡¨ï¼‰
   - æ ¼å¼ï¼š`600000.SH`ã€`000001.SZ`
   - ç‰¹å¾ï¼šå·²ç¡®è®¤å…·æœ‰"å¹³åº•é”…"å½¢æ€ï¼ˆæ›¾ç»é«˜ä¼ï¼Œåé•¿æœŸçª„å¹…éœ‡è¡ï¼‰

2. **å†å²æ•°æ®**ï¼ˆå¯é€‰ï¼Œæ¥è‡ªæ•°æ®åº“å’Œæ–‡ä»¶ç³»ç»Ÿï¼‰
   - æœˆ K çº¿æ•°æ®ï¼š`stock_monthly_kline` è¡¨
   - K çº¿å›¾ PNG æ–‡ä»¶ï¼š`output/{code}_kline.png`

**è¾“å‡º**ï¼š
1. **ç»“æ„åŒ–åˆ†ææŠ¥å‘Š**ï¼ˆMarkdown æ ¼å¼ï¼‰
   - å¹³åº•é”…å½¢æ€ç‰¹å¾åˆ†æ
   - æ¿å—çƒ­åº¦ä¸è¶‹åŠ¿è¯„ä¼°
   - å…¬å¸åŸºæœ¬é¢ä¸å‚¬åŒ–å‰‚è¯†åˆ«
   - æŠ€æœ¯åˆ†æï¼ˆæ”¯æ’‘/é˜»åŠ›ä½ã€çªç ´æ¦‚ç‡ï¼‰
   - ç»¼åˆæ¨èè¯„åˆ†ï¼ˆ0-10 åˆ†ï¼‰
   - æ¨èç†ç”±ä¸é£é™©æç¤º

2. **æ•°æ®åº“è®°å½•**ï¼ˆå†™å…¥ `stock_analysis_results` è¡¨ï¼‰
   - æ¨èè¯„åˆ†ã€ç†ç”±ã€è¯¦ç»†åˆ†ææ•°æ®ï¼ˆJSONBï¼‰

### 1.3 æ ¸å¿ƒç‰¹æ€§

- âœ… **Magentic æ™ºèƒ½ç¼–æ’**ï¼šManager Agent åŠ¨æ€åˆ†è§£ä»»åŠ¡ï¼Œè‡ªé€‚åº”è°ƒåº¦ä¸“å®¶ Agent
- âœ… **åŒè´¦æœ¬æœºåˆ¶**ï¼šTask Ledgerï¼ˆä»»åŠ¡æ¸…å•ï¼‰+ Progress Ledgerï¼ˆæ‰§è¡Œè¿›åº¦ï¼‰ï¼Œç¡®ä¿åˆ†æå®Œæ•´æ€§
- âœ… **äººåœ¨å›è·¯**ï¼šå…³é”®å†³ç­–ç‚¹æ”¯æŒäººå·¥å®¡æ‰¹ï¼ˆå¯é€‰ï¼‰
- âœ… **Web Search èƒ½åŠ›**ï¼šè‡ªåŠ¨æœç´¢æ¿å—çƒ­åº¦ã€å…¬å¸æ–°é—»ã€æ”¿ç­–åŠ¨å‘
- âœ… **å¤šæ¨¡æ€åˆ†æ**ï¼šæ”¯æŒè¯»å– K çº¿å›¾ PNGï¼ˆVision èƒ½åŠ›ï¼‰
- âœ… **æ•°æ®åº“é›†æˆ**ï¼šæ— ç¼å¯¹æ¥ç°æœ‰ PostgreSQL æ•°æ®åº“
- âœ… **å¼‚æ­¥é«˜æ•ˆ**ï¼šåŸºäº asyncioï¼Œæ”¯æŒæ‰¹é‡å¹¶å‘åˆ†æ
- âœ… **å¯è§‚æµ‹æ€§**ï¼šæ”¯æŒ OpenTelemetry è·Ÿè¸ªï¼Œä¾¿äºè°ƒè¯•å’Œç›‘æ§

---

## 2. æŠ€æœ¯æ ˆ

### 2.1 æ ¸å¿ƒæ¡†æ¶

| ç»„ä»¶ | ç‰ˆæœ¬ | è¯´æ˜ |
|------|------|------|
| **Microsoft Agent Framework** | **python-1.0.0b260130** | å¤š Agent ç¼–æ’æ¡†æ¶ï¼ˆæœ€æ–°ç‰ˆï¼‰ |
| Python | 3.12.x | è¯­è¨€è¿è¡Œæ—¶ |
| PostgreSQL | 14+ | æ•°æ®å­˜å‚¨ |
| asyncio | å†…ç½® | å¼‚æ­¥ I/O |
| asyncpg | æœ€æ–° | å¼‚æ­¥ PostgreSQL é©±åŠ¨ |

### 2.2 LLM æ”¯æŒ

ç³»ç»Ÿæ”¯æŒå¤šç§ LLM æä¾›å•†ï¼ˆé€šè¿‡ MAF çš„ç»Ÿä¸€æ¥å£ï¼‰ï¼š

| æä¾›å•† | æ¨¡å‹æ¨è | ç”¨é€” |
|--------|---------|------|
| OpenAI | GPT-4o | Manager Agentï¼ˆå¼ºæ¨ç†èƒ½åŠ›ï¼‰ |
| OpenAI | GPT-4o-mini | Worker Agentsï¼ˆæˆæœ¬ä¼˜åŒ–ï¼‰ |
| DashScopeï¼ˆé˜¿é‡Œäº‘ï¼‰ | qwen-plus / qwen-max | å›½å†…æ›¿ä»£æ–¹æ¡ˆ |
| Azure OpenAI | GPT-4o | ä¼ä¸šéƒ¨ç½² |
| Google Gemini | Gemini 2.0 Flash | å¤šæ¨¡æ€æ”¯æŒ |

**æ¨èé…ç½®**ï¼š
- **Manager Agent**ï¼šGPT-4oï¼ˆä»»åŠ¡åˆ†è§£å’Œå†³ç­–éœ€è¦å¼ºæ¨ç†èƒ½åŠ›ï¼‰
- **Research Agents**ï¼šGPT-4o-mini æˆ– qwen-plusï¼ˆæˆæœ¬ä¸æ€§èƒ½å¹³è¡¡ï¼‰
- **Technical Analyst**ï¼šGPT-4oï¼ˆå›¾åƒè¯†åˆ«éœ€è¦å¤šæ¨¡æ€èƒ½åŠ›ï¼‰

### 2.3 MAF python-1.0.0b260130 æ–°ç‰¹æ€§åº”ç”¨

æ ¹æ® [GitHub Release](https://github.com/microsoft/agent-framework/releases/tag/python-1.0.0b260130)ï¼Œæœ€æ–°ç‰ˆæœ¬åŒ…å«ä»¥ä¸‹å…³é”®æ›´æ–°ï¼š

1. **Generic Type Parameters**ï¼ˆPR #3305ï¼‰
   - `ChatOptions` å’Œ `ChatResponse`/`AgentResponse` ç°åœ¨æ”¯æŒæ³›å‹
   - **è®¾è®¡åº”ç”¨**ï¼šä½¿ç”¨ç±»å‹æç¤ºå¢å¼ºä»£ç å¯ç»´æŠ¤æ€§
   ```python
   from agent_framework import ChatOptions, ChatResponse

   options: ChatOptions[MyResponseFormat] = ChatOptions(...)
   response: ChatResponse[MyResponseFormat] = await agent.run(...)
   ```

2. **Claude Agent SDK Support**ï¼ˆPR #3509ï¼‰
   - æ–°å¢ `BaseAgent` å®ç°ç”¨äº Claude Agent SDK é›†æˆ
   - **è®¾è®¡åº”ç”¨**ï¼šå¦‚æœéœ€è¦ä½¿ç”¨ Claude APIï¼Œå¯ç›´æ¥é€šè¿‡ SDK é›†æˆ

3. **Improved Testing & Coverage**
   - æ ¸å¿ƒç±»å‹ã€Agentã€å·¥å…·å‡½æ•°çš„æµ‹è¯•è¦†ç›–ç‡æå‡
   - **è®¾è®¡åº”ç”¨**ï¼šå‚è€ƒå®˜æ–¹æµ‹è¯•ç”¨ä¾‹ç¼–å†™å•å…ƒæµ‹è¯•

4. **Durable Task Package Update**ï¼ˆPR #3492ï¼‰
   - æ›´ç¨³å®šçš„é•¿æ—¶ä»»åŠ¡æ”¯æŒ
   - **è®¾è®¡åº”ç”¨**ï¼šç”¨äºæ‰¹é‡åˆ†æä»»åŠ¡çš„æŒä¹…åŒ–

### 2.4 æ•°æ®ä¾èµ–

**Python åŒ…**ï¼š
```toml
[project.dependencies]
agent-framework = "1.0.0b260130"  # MAF æœ€æ–°ç‰ˆæœ¬
asyncpg = ">=0.29.0"              # å¼‚æ­¥ PostgreSQL
pandas = ">=2.0.0"                # æ•°æ®å¤„ç†
numpy = ">=1.24.0"                # æ•°å€¼è®¡ç®—
pillow = ">=10.0.0"               # å›¾åƒå¤„ç†
python-dotenv = ">=1.0.0"         # ç¯å¢ƒé…ç½®
pydantic = ">=2.0.0"              # æ•°æ®éªŒè¯
httpx = ">=0.27.0"                # HTTP å®¢æˆ·ç«¯ï¼ˆWeb Searchï¼‰
```

**å¯é€‰åŒ…ï¼ˆå¢å¼ºåŠŸèƒ½ï¼‰**ï¼š
```toml
opentelemetry-api = ">=1.20.0"          # å¯è§‚æµ‹æ€§
opentelemetry-sdk = ">=1.20.0"
opentelemetry-exporter-otlp = ">=1.20.0"
pytest = ">=8.0.0"                      # æµ‹è¯•
pytest-asyncio = ">=0.23.0"
```

---

## 3. Agent æ¶æ„è®¾è®¡

### 3.1 æ•´ä½“æ¶æ„ï¼ˆMagentic ç¼–æ’æ¨¡å¼ï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    StockAnalysisManager                          â”‚
â”‚                     (Manager Agent)                              â”‚
â”‚                                                                  â”‚
â”‚  èŒè´£ï¼š                                                           â”‚
â”‚  - ä»»åŠ¡åˆ†è§£ï¼šå°†"åˆ†æè‚¡ç¥¨X"æ‹†è§£ä¸º10+å­ä»»åŠ¡                         â”‚
â”‚  - åŠ¨æ€è§„åˆ’ï¼šæ ¹æ®ä¸­é—´ç»“æœè°ƒæ•´åç»­ä»»åŠ¡                            â”‚
â”‚  - åŒè´¦æœ¬ç»´æŠ¤ï¼š                                                   â”‚
â”‚    * Task Ledgerï¼ˆå¾…åŠæ¸…å•ï¼‰                                      â”‚
â”‚    * Progress Ledgerï¼ˆå·²å®Œæˆäº‹é¡¹ï¼‰                               â”‚
â”‚  - è´¨é‡æ§åˆ¶ï¼šéªŒè¯ Agent è¾“å‡ºï¼Œå†³å®šæ˜¯å¦é‡è¯•æˆ–è·³è¿‡                  â”‚
â”‚  - ç»“æœç»¼åˆï¼šæ•´åˆå„ Agent ç»“è®ºï¼Œç”Ÿæˆæœ€ç»ˆæ¨è                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚          â”‚          â”‚          â”‚          â”‚          â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â” â”Œâ”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â” â”Œâ”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ–¼â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Stock     â”‚ â”‚  Sector  â”‚ â”‚ Company  â”‚ â”‚  Tech   â”‚ â”‚ Report  â”‚
â”‚  Data      â”‚ â”‚ Research â”‚ â”‚ Research â”‚ â”‚ Analyst â”‚ â”‚ Writer  â”‚
â”‚  Agent     â”‚ â”‚  Agent   â”‚ â”‚  Agent   â”‚ â”‚  Agent  â”‚ â”‚  Agent  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚              â”‚              â”‚           â”‚            â”‚
     â–¼              â–¼              â–¼           â–¼            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚Databaseâ”‚   â”‚Web Searchâ”‚  â”‚Web Searchâ”‚ â”‚Vision â”‚   â”‚Databaseâ”‚
â”‚ Tools  â”‚   â”‚  Tools   â”‚  â”‚  Tools   â”‚ â”‚Tools  â”‚   â”‚ Tools  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.2 Manager Agent è®¾è®¡

**è§’è‰²å®šä¹‰**ï¼šè‚¡ç¥¨åˆ†æä»»åŠ¡çš„æ€»æŒ‡æŒ¥

**æ ¸å¿ƒèƒ½åŠ›**ï¼š
1. **ä»»åŠ¡åˆ†è§£**ï¼šå°†ç”¨æˆ·è¯·æ±‚æ‹†è§£ä¸ºå…·ä½“å­ä»»åŠ¡
2. **Agent è°ƒåº¦**ï¼šæ ¹æ®å­ä»»åŠ¡ç±»å‹é€‰æ‹©åˆé€‚çš„ Worker Agent
3. **åŠ¨æ€è§„åˆ’**ï¼šæ ¹æ®ä¸­é—´ç»“æœè°ƒæ•´è®¡åˆ’ï¼ˆå¦‚ï¼šæ¿å—çƒ­åº¦ä½åˆ™åŠ å¼ºå…¬å¸åŸºæœ¬é¢è°ƒæŸ¥ï¼‰
4. **è¿›åº¦è·Ÿè¸ª**ï¼šç»´æŠ¤åŒè´¦æœ¬ï¼ˆTask Ledger + Progress Ledgerï¼‰
5. **è´¨é‡æ§åˆ¶**ï¼šæ£€æŸ¥ Agent è¾“å‡ºçš„åˆç†æ€§ï¼Œå†³å®šæ˜¯å¦æ¥å—/é‡è¯•/è·³è¿‡
6. **åœæ»æ£€æµ‹**ï¼šè¯†åˆ«æ— è¿›å±•çŠ¶æ€ï¼Œè§¦å‘äººå·¥å¹²é¢„æˆ–é‡ç½®

**System Message è®¾è®¡è¦ç‚¹**ï¼š
```python
manager_system_message = """
ä½ æ˜¯ä¸€ä½èµ„æ·±è‚¡ç¥¨åˆ†ææ€»ç›‘ï¼Œè´Ÿè´£åè°ƒå¤šä¸ªä¸“å®¶å›¢é˜Ÿå®Œæˆè‚¡ç¥¨æ·±åº¦åˆ†æã€‚

ä½ çš„å›¢é˜Ÿæˆå‘˜åŒ…æ‹¬ï¼š
1. StockDataAgent - æ•°æ®è·å–ä¸“å®¶ï¼šä»æ•°æ®åº“è¯»å–Kçº¿æ•°æ®ï¼Œè®¡ç®—æŠ€æœ¯æŒ‡æ ‡
2. SectorResearchAgent - æ¿å—ç ”ç©¶ä¸“å®¶ï¼šåˆ†æè¡Œä¸šè¶‹åŠ¿ã€æ¿å—çƒ­åº¦
3. CompanyResearchAgent - å…¬å¸ç ”ç©¶ä¸“å®¶ï¼šè°ƒç ”åŸºæœ¬é¢ã€è¯†åˆ«å‚¬åŒ–å‰‚
4. TechnicalAnalystAgent - æŠ€æœ¯åˆ†æä¸“å®¶ï¼šè®¡ç®—æ”¯æ’‘é˜»åŠ›ä½ã€è¯„ä¼°çªç ´æ¦‚ç‡
5. ReportWriterAgent - æŠ¥å‘Šæ’°å†™ä¸“å®¶ï¼šæ•´åˆä¿¡æ¯ï¼Œç”Ÿæˆåˆ†ææŠ¥å‘Š

å·¥ä½œæµç¨‹ï¼š
1. æ¥æ”¶è‚¡ç¥¨ä»£ç åï¼Œé¦–å…ˆåˆ¶å®šè¯¦ç»†çš„åˆ†æè®¡åˆ’ï¼ˆåŒ…å«10+å­ä»»åŠ¡ï¼‰
2. æŒ‰ä¼˜å…ˆçº§è°ƒåº¦å„ Agent æ‰§è¡Œä»»åŠ¡
3. æ ¹æ®ä¸­é—´ç»“æœåŠ¨æ€è°ƒæ•´åç»­ä»»åŠ¡ï¼ˆå¦‚ï¼šæ¿å—çƒ­åº¦é«˜â†’æ·±æŒ–å‚¬åŒ–å‰‚ï¼›æ¿å—çƒ­åº¦ä½â†’å…³æ³¨å…¬å¸è‡ªèº«åˆ©å¥½ï¼‰
4. éªŒè¯æ¯ä¸ª Agent çš„è¾“å‡ºè´¨é‡ï¼Œå¿…è¦æ—¶è¦æ±‚é‡åšæˆ–è¡¥å……
5. ç¡®ä¿æ‰€æœ‰å…³é”®ç»´åº¦ï¼ˆæ¿å—+å…¬å¸+æŠ€æœ¯ï¼‰éƒ½è¢«å……åˆ†åˆ†æ
6. æœ€ç»ˆæŒ‡ç¤º ReportWriterAgent ç”ŸæˆæŠ¥å‘Š

è´¨é‡æ ‡å‡†ï¼š
- æ¿å—åˆ†æï¼šè‡³å°‘è¯†åˆ«3ä¸ªæ¿å—ï¼Œæ¯ä¸ªæ¿å—ç»™å‡ºçƒ­åº¦è¯„åˆ†ï¼ˆ0-10ï¼‰
- å…¬å¸åˆ†æï¼šè‡³å°‘åˆ—ä¸¾3æ¡æœ€æ–°åŠ¨æ€æˆ–å‚¬åŒ–å‰‚
- æŠ€æœ¯åˆ†æï¼šå¿…é¡»ç»™å‡ºæ”¯æ’‘/é˜»åŠ›ä½å’Œçªç ´æ¦‚ç‡
- æœ€ç»ˆæ¨èï¼šè¯„åˆ†éœ€æœ‰æ˜ç¡®ä¾æ®ï¼Œç†ç”±éœ€ç®€æ˜æ‰¼è¦ï¼ˆ50å­—å†…ï¼‰

åœæ»å¤„ç†ï¼š
- å¦‚æœæŸä¸ª Agent è¿ç»­3æ¬¡æœªèƒ½ç»™å‡ºæœ‰æ•ˆè¾“å‡ºï¼Œè®°å½•é—®é¢˜å¹¶è·³è¿‡
- å¦‚æœå…³é”®ä»»åŠ¡æ— æ³•å®Œæˆï¼ˆå¦‚æ•°æ®åº“æ— æ•°æ®ï¼‰ï¼Œåœæ­¢åˆ†æå¹¶è¯´æ˜åŸå› 
"""
```

**é…ç½®å‚æ•°**ï¼š
```python
manager_config = {
    "max_stall_count": 3,      # æœ€å¤š3è½®æ— è¿›å±•åˆ™è§¦å‘åœæ»æ£€æµ‹
    "max_reset_count": 2,      # æœ€å¤šé‡ç½®2æ¬¡
    "enable_plan_review": True, # å¯ç”¨äººå·¥å®¡æ‰¹ï¼ˆå¯é€‰ï¼‰
    "temperature": 0.7,        # æ¨ç†æ¸©åº¦ï¼ˆç•¥é«˜ä»¥ä¿è¯åˆ›é€ æ€§ï¼‰
}
```

### 3.3 Worker Agents è®¾è®¡

#### 3.3.1 StockDataAgentï¼ˆæ•°æ®è·å–ä¸“å®¶ï¼‰

**èŒè´£**ï¼šä»æ•°æ®åº“è¯»å–è‚¡ç¥¨ K çº¿æ•°æ®ï¼Œè®¡ç®—æŠ€æœ¯æŒ‡æ ‡ï¼Œè¯†åˆ«å¹³åº•é”…å½¢æ€ç‰¹å¾

**å·¥å…·å‡½æ•°**ï¼š
```python
async def query_stock_kline(code: str, months: int = 12) -> pd.DataFrame
    """æŸ¥è¯¢è‚¡ç¥¨æœˆKçº¿æ•°æ®"""

async def calculate_technical_indicators(code: str) -> dict
    """è®¡ç®—æŠ€æœ¯æŒ‡æ ‡ï¼ˆå³°å€¼ä»·æ ¼ã€éœ‡è¡æ—¶é•¿ã€æ³¢åŠ¨ç‡ç­‰ï¼‰"""

async def detect_flatbottom_features(code: str) -> dict
    """è¯†åˆ«å¹³åº•é”…ç‰¹å¾ï¼ˆä» stock_flatbottom_preselect è¡¨è¯»å–ï¼‰"""

async def get_stock_basic_info(code: str) -> dict
    """è·å–è‚¡ç¥¨åŸºæœ¬ä¿¡æ¯ï¼ˆåç§°ã€å½“å‰ä»·æ ¼ï¼‰"""
```

**è¾“å‡ºæ ¼å¼**ï¼š
```json
{
  "code": "600000.SH",
  "name": "æµ¦å‘é“¶è¡Œ",
  "current_price": 8.50,
  "peak_price": 25.60,
  "peak_time": "2015-06",
  "oscillation_months": 102,
  "drawdown_pct": -66.8,
  "box_range_pct": 15.2,
  "volatility_ratio": 0.45,
  "price_position": 0.42,
  "volume_trend": "æ¸©å’Œæ”¾é‡"
}
```

**System Message è¦ç‚¹**ï¼š
- å¼ºè°ƒæ•°æ®å‡†ç¡®æ€§ï¼šæ‰€æœ‰æ•°å€¼éœ€ä»æ•°æ®åº“æŸ¥è¯¢ï¼Œä¸å¯è‡†é€ 
- å¼‚å¸¸å¤„ç†ï¼šæ•°æ®ç¼ºå¤±æˆ–å¼‚å¸¸æ—¶æ˜ç¡®è¯´æ˜ï¼Œä¸è¦ç»§ç»­åˆ†æ

---

#### 3.3.2 SectorResearchAgentï¼ˆæ¿å—ç ”ç©¶ä¸“å®¶ï¼‰

**èŒè´£**ï¼šåˆ†æè‚¡ç¥¨æ‰€å±æ¿å—ï¼Œè¯„ä¼°æ¿å—çƒ­åº¦ã€è¶‹åŠ¿ã€æ”¿ç­–æ”¯æŒåŠ›åº¦

**å·¥å…·å‡½æ•°**ï¼š
```python
async def search_stock_sectors(code: str, name: str) -> List[str]
    """ä½¿ç”¨ Web Search æœç´¢è‚¡ç¥¨æ‰€å±æ¿å—ï¼ˆä¸»æ¿å—+æ¦‚å¿µæ¿å—ï¼‰"""

async def analyze_sector_hotness(sector: str, months: int = 6) -> dict
    """æœç´¢æ¿å—æœ€è¿‘Nä¸ªæœˆçš„æ–°é—»çƒ­åº¦å’Œè¶‹åŠ¿"""

async def get_sector_policy_support(sector: str) -> dict
    """æœç´¢æ¿å—æ”¿ç­–æ”¯æŒæƒ…å†µï¼ˆå›½å®¶æ”¿ç­–ã€åœ°æ–¹æ”¿ç­–ï¼‰"""

async def compare_sector_leaders(sector: str, code: str) -> dict
    """å¯¹æ¯”åŒæ¿å—é¾™å¤´è‚¡çš„è¡¨ç°"""
```

**Web Search ç­–ç•¥**ï¼š
1. **æœç´¢è‚¡ç¥¨æ‰€å±æ¿å—**ï¼š
   - æŸ¥è¯¢è¯ï¼š`"{stock_name} æ‰€å±æ¿å— æ¦‚å¿µæ¿å— 2025 2026"`
   - ç›®æ ‡ï¼šè¯†åˆ«2-4ä¸ªä¸»è¦æ¿å—
   - ç¤ºä¾‹ï¼š`"æµ¦å‘é“¶è¡Œ æ‰€å±æ¿å— æ¦‚å¿µæ¿å— 2025 2026"` â†’ é“¶è¡Œã€ä¸Šæµ·å›½ä¼æ”¹é©ã€æ²ªæ¸¯é€š

2. **æœç´¢æ¿å—çƒ­åº¦**ï¼š
   - æŸ¥è¯¢è¯ï¼š`"{sector} æ¿å— æœ€è¿‘6ä¸ªæœˆ è¶‹åŠ¿ æ–°é—» çƒ­ç‚¹"`
   - ç›®æ ‡ï¼šåˆ¤æ–­æ¿å—æ˜¯å¦å¤„äºä¸Šå‡å‘¨æœŸ
   - ç¤ºä¾‹ï¼š`"é“¶è¡Œæ¿å— æœ€è¿‘6ä¸ªæœˆ è¶‹åŠ¿ æ–°é—» çƒ­ç‚¹"` â†’ åˆ†ææ–°é—»æ•°é‡ã€æƒ…ç»ªå€¾å‘

3. **æœç´¢æ”¿ç­–æ”¯æŒ**ï¼š
   - æŸ¥è¯¢è¯ï¼š`"{sector} æ”¿ç­–æ”¯æŒ 2025 2026 å›½å®¶æ”¿ç­–"`
   - ç›®æ ‡ï¼šè¯†åˆ«æ”¿ç­–å‚¬åŒ–å‰‚
   - ç¤ºä¾‹ï¼š`"é“¶è¡Œæ¿å— æ”¿ç­–æ”¯æŒ 2025 2026"` â†’ LPRæ”¹é©ã€åˆ©ç‡å¸‚åœºåŒ–

4. **å¯¹æ¯”é¾™å¤´è‚¡**ï¼š
   - æŸ¥è¯¢è¯ï¼š`"{sector} é¾™å¤´è‚¡ æ’å å¸‚å€¼"`
   - ç›®æ ‡ï¼šè¯„ä¼°ç›®æ ‡è‚¡ç¥¨åœ¨æ¿å—ä¸­çš„åœ°ä½
   - ç¤ºä¾‹ï¼š`"é“¶è¡Œæ¿å— é¾™å¤´è‚¡ æ’å"` â†’ å·¥å•†é“¶è¡Œã€å»ºè®¾é“¶è¡Œ...

**è¾“å‡ºæ ¼å¼**ï¼š
```json
{
  "sectors": [
    {
      "name": "é“¶è¡Œ",
      "type": "ä¸»æ¿å—",
      "hotness_score": 6.5,
      "trend": "éœ‡è¡",
      "policy_support": "ä¸­æ€§",
      "news_count_6m": 120,
      "key_catalysts": ["åˆ©ç‡å¸‚åœºåŒ–æ”¹é©", "ä¸è‰¯èµ„äº§å¤„ç½®"]
    },
    {
      "name": "ä¸Šæµ·å›½ä¼æ”¹é©",
      "type": "æ¦‚å¿µæ¿å—",
      "hotness_score": 7.8,
      "trend": "ä¸Šå‡",
      "policy_support": "å¼º",
      "news_count_6m": 85,
      "key_catalysts": ["æ·±åŒ–å›½ä¼æ”¹é©ä¸‰å¹´è¡ŒåŠ¨", "å¸‚å€¼ç®¡ç†"]
    }
  ],
  "sector_position": "è¡Œä¸šå‰5",
  "overall_assessment": "æ¿å—çƒ­åº¦ä¸­ç­‰ï¼Œæ¦‚å¿µæ¿å—æœ‰æ”¿ç­–å‚¬åŒ–å‰‚"
}
```

**System Message è¦ç‚¹**ï¼š
- è‡³å°‘è¯†åˆ«3ä¸ªæ¿å—ï¼ˆ1-2ä¸ªä¸»æ¿å— + 1-2ä¸ªæ¦‚å¿µæ¿å—ï¼‰
- æ¯ä¸ªæ¿å—å¿…é¡»ç»™å‡ºçƒ­åº¦è¯„åˆ†ï¼ˆ0-10ï¼‰å’Œè¶‹åŠ¿åˆ¤æ–­
- é‡ç‚¹å…³æ³¨æ”¿ç­–å‚¬åŒ–å‰‚å’Œè¡Œä¸šæ‹ç‚¹ä¿¡å·

---

#### 3.3.3 CompanyResearchAgentï¼ˆå…¬å¸ç ”ç©¶ä¸“å®¶ï¼‰

**èŒè´£**ï¼šæ·±åº¦è°ƒç ”å…¬å¸åŸºæœ¬é¢ã€æœ€æ–°åŠ¨æ€ã€é‡å¤§äº‹ä»¶ã€å‚¬åŒ–å‰‚

**å·¥å…·å‡½æ•°**ï¼š
```python
async def search_company_news(code: str, name: str, months: int = 6) -> List[dict]
    """æœç´¢å…¬å¸æœ€è¿‘Nä¸ªæœˆçš„æ–°é—»ï¼ˆè´¢æŠ¥ã€å…¬å‘Šã€é‡å¤§äº‹ä»¶ï¼‰"""

async def analyze_financial_events(code: str, name: str) -> dict
    """åˆ†æå…¬å¸è´¢åŠ¡äº‹ä»¶ï¼ˆä¸šç»©é¢„å‘Šã€è´¢æŠ¥ã€åˆ†çº¢ç­‰ï¼‰"""

async def identify_catalysts(code: str, name: str) -> List[str]
    """è¯†åˆ«å‚¬åŒ–å‰‚äº‹ä»¶ï¼ˆå¹¶è´­ã€æ–°äº§å“ã€å¤§è®¢å•ã€æ”¿ç­–æ‰¶æŒç­‰ï¼‰"""

async def assess_competitive_position(name: str, sector: str) -> dict
    """è¯„ä¼°å…¬å¸åœ¨è¡Œä¸šä¸­çš„ç«äº‰åœ°ä½"""
```

**Web Search ç­–ç•¥**ï¼š
1. **æœç´¢æœ€æ–°è´¢æŠ¥**ï¼š
   - æŸ¥è¯¢è¯ï¼š`"{company_name} æœ€æ–°è´¢æŠ¥ ä¸šç»© 2025 2026"`
   - ç›®æ ‡ï¼šè¥æ”¶ã€å‡€åˆ©æ¶¦ã€åŒæ¯”å¢é•¿ã€ä¸šç»©é¢„å‘Š
   - ç¤ºä¾‹ï¼š`"æµ¦å‘é“¶è¡Œ æœ€æ–°è´¢æŠ¥ ä¸šç»© 2025"` â†’ Q3è´¢æŠ¥ã€ä¸šç»©å¢é•¿æƒ…å†µ

2. **æœç´¢é‡å¤§äº‹ä»¶**ï¼š
   - æŸ¥è¯¢è¯ï¼š`"{company_name} é‡å¤§äº‹ä»¶ å…¬å‘Š 2025 2026"`
   - ç›®æ ‡ï¼šå¹¶è´­ã€èµ„äº§é‡ç»„ã€å¤§é¢è®¢å•ã€ç®¡ç†å±‚å˜åŠ¨
   - ç¤ºä¾‹ï¼š`"æµ¦å‘é“¶è¡Œ é‡å¤§äº‹ä»¶ å…¬å‘Š 2025"` â†’ å¢èµ„æ‰©è‚¡ã€æˆ˜ç•¥åˆä½œ

3. **æœç´¢å‚¬åŒ–å‰‚**ï¼š
   - æŸ¥è¯¢è¯ï¼š`"{company_name} åˆ©å¥½ å‚¬åŒ–å‰‚ 2025 2026"`
   - ç›®æ ‡ï¼šçŸ­æœŸå¯èƒ½æ¨åŠ¨è‚¡ä»·çš„äº‹ä»¶
   - ç¤ºä¾‹ï¼š`"æµ¦å‘é“¶è¡Œ åˆ©å¥½ å‚¬åŒ–å‰‚ 2025"` â†’ æ”¿ç­–åˆ©å¥½ã€è‚¡ä¸œå¢æŒ

4. **æœç´¢ç«äº‰åœ°ä½**ï¼š
   - æŸ¥è¯¢è¯ï¼š`"{company_name} {sector} å¸‚åœºä»½é¢ æ’å"`
   - ç›®æ ‡ï¼šè¡Œä¸šåœ°ä½ã€å¸‚å ç‡ã€ç«äº‰ä¼˜åŠ¿
   - ç¤ºä¾‹ï¼š`"æµ¦å‘é“¶è¡Œ é“¶è¡Œä¸š å¸‚åœºä»½é¢ æ’å"` â†’ å…¨å›½è‚¡ä»½åˆ¶é“¶è¡Œç¬¬Xå

**è¾“å‡ºæ ¼å¼**ï¼š
```json
{
  "basic_info": {
    "industry_position": "å…¨å›½è‚¡ä»½åˆ¶é“¶è¡Œç¬¬3å",
    "market_cap": "2500äº¿å…ƒ",
    "main_business": "å•†ä¸šé“¶è¡Œä¸šåŠ¡"
  },
  "recent_news": [
    {
      "date": "2025-12-15",
      "title": "æµ¦å‘é“¶è¡ŒQ3å‡€åˆ©æ¶¦åŒæ¯”å¢é•¿8.5%",
      "impact": "positive",
      "importance": "high"
    },
    {
      "date": "2025-11-20",
      "title": "æµ¦å‘é“¶è¡Œä¸XXé›†å›¢ç­¾ç½²æˆ˜ç•¥åˆä½œåè®®",
      "impact": "positive",
      "importance": "medium"
    }
  ],
  "catalysts": [
    "Q4è´¢æŠ¥è¶…é¢„æœŸå¯èƒ½æ€§è¾ƒå¤§",
    "å›½ä¼æ”¹é©æ·±åŒ–å¸¦æ¥ä¼°å€¼ä¿®å¤",
    "åˆ©ç‡å¸‚åœºåŒ–æ”¹é©åˆ©å¥½æ¯å·®æ”¹å–„"
  ],
  "risks": [
    "æˆ¿åœ°äº§è´·æ¬¾é£é™©æš´éœ²",
    "ç»æµä¸‹è¡Œå‹åŠ›å½±å“èµ„äº§è´¨é‡"
  ],
  "financial_health": "è‰¯å¥½",
  "overall_assessment": "åŸºæœ¬é¢ç¨³å¥ï¼Œå­˜åœ¨æ”¿ç­–å’Œä¸šç»©åŒé‡å‚¬åŒ–å‰‚"
}
```

**System Message è¦ç‚¹**ï¼š
- è‡³å°‘åˆ—ä¸¾3æ¡æœ€æ–°åŠ¨æ€ï¼ˆ6ä¸ªæœˆå†…ï¼‰
- æ˜ç¡®åŒºåˆ†åˆ©å¥½ã€åˆ©ç©ºã€ä¸­æ€§äº‹ä»¶
- è¯†åˆ«è‡³å°‘2ä¸ªå‚¬åŒ–å‰‚ï¼ˆçŸ­æœŸå¯èƒ½æ¨åŠ¨è‚¡ä»·çš„å› ç´ ï¼‰
- è¯„ä¼°è´¢åŠ¡å¥åº·åº¦ï¼ˆä¼˜ç§€/è‰¯å¥½/ä¸­ç­‰/è¾ƒå·®ï¼‰

---

#### 3.3.4 TechnicalAnalystAgentï¼ˆæŠ€æœ¯åˆ†æä¸“å®¶ï¼‰

**èŒè´£**ï¼šåˆ†æ K çº¿å½¢æ€ï¼Œè®¡ç®—æ”¯æ’‘/é˜»åŠ›ä½ï¼Œè¯„ä¼°çªç ´æ¦‚ç‡

**å·¥å…·å‡½æ•°**ï¼š
```python
async def analyze_kline_chart(image_path: str) -> dict
    """è¯»å–Kçº¿å›¾PNGï¼Œè¯†åˆ«å½¢æ€ç‰¹å¾ï¼ˆéœ€è¦Visionèƒ½åŠ›ï¼‰"""

async def calculate_support_resistance(code: str) -> dict
    """åŸºäºå†å²æ•°æ®è®¡ç®—æ”¯æ’‘ä½å’Œé˜»åŠ›ä½"""

async def evaluate_breakout_probability(
    code: str,
    sector_info: dict,
    company_info: dict
) -> float
    """ç»“åˆæ¿å—çƒ­åº¦å’Œå…¬å¸åŸºæœ¬é¢ï¼Œè¯„ä¼°æŠ€æœ¯çªç ´æ¦‚ç‡ï¼ˆ0-1ï¼‰"""

async def analyze_volume_trend(code: str) -> dict
    """åˆ†ææˆäº¤é‡è¶‹åŠ¿ï¼ˆæ”¾é‡/ç¼©é‡ï¼‰"""
```

**å¤šæ¨¡æ€èƒ½åŠ›**ï¼š
- ä½¿ç”¨ LLM çš„ Vision API è¯»å– K çº¿å›¾ PNG æ–‡ä»¶
- è¯†åˆ«å…³é”®å½¢æ€ï¼šå¹³åº•é”…ã€çªç ´ä¿¡å·ã€èƒŒç¦»ç­‰
- é…åˆæ•°æ®åº“æ•°æ®è¿›è¡Œé‡åŒ–éªŒè¯

**è¾“å‡ºæ ¼å¼**ï¼š
```json
{
  "current_position": {
    "price": 8.50,
    "support_level": 8.20,
    "resistance_level": 9.50,
    "position_in_box": "ä¸­ä½åä¸‹"
  },
  "technical_indicators": {
    "ma20": 8.45,
    "ma60": 8.60,
    "rsi": 48,
    "macd": "æ­»å‰"
  },
  "pattern_analysis": {
    "pattern_type": "å¹³åº•é”…æœ«æœŸ",
    "maturity": "æˆç†Ÿ",
    "consolidation_days": 102,
    "volume_trend": "æ¸©å’Œæ”¾é‡"
  },
  "breakout_analysis": {
    "breakout_probability": 0.65,
    "catalyst_needed": "éœ€è¦æ¿å—æˆ–å…¬å¸å‚¬åŒ–å‰‚",
    "target_price_6m": 10.50,
    "stop_loss": 7.80
  },
  "overall_assessment": "å½¢æ€æˆç†Ÿï¼Œç­‰å¾…å‚¬åŒ–å‰‚çªç ´ï¼Œæ¦‚ç‡65%"
}
```

**System Message è¦ç‚¹**ï¼š
- å¿…é¡»ç»™å‡ºæ”¯æ’‘ä½å’Œé˜»åŠ›ä½ï¼ˆå…·ä½“ä»·æ ¼ï¼‰
- çªç ´æ¦‚ç‡éœ€ç»¼åˆè€ƒè™‘ï¼šå½¢æ€æˆç†Ÿåº¦ + æ¿å—çƒ­åº¦ + å…¬å¸å‚¬åŒ–å‰‚
- å¦‚æœæœ‰ K çº¿å›¾ PNGï¼Œä¼˜å…ˆåˆ†æå›¾åƒï¼›å¦åˆ™åŸºäºæ•°æ®åº“æ•°æ®

---

#### 3.3.5 ReportWriterAgentï¼ˆæŠ¥å‘Šæ’°å†™ä¸“å®¶ï¼‰

**èŒè´£**ï¼šæ•´åˆæ‰€æœ‰ Agent çš„ç ”ç©¶ç»“æœï¼Œç”Ÿæˆ Markdown æŠ¥å‘Šï¼Œè®¡ç®—æ¨èè¯„åˆ†ï¼Œå†™å…¥æ•°æ®åº“

**å·¥å…·å‡½æ•°**ï¼š
```python
async def generate_report(
    stock_data: dict,
    sector_analysis: dict,
    company_analysis: dict,
    technical_analysis: dict
) -> str
    """ç”Ÿæˆ Markdown æ ¼å¼åˆ†ææŠ¥å‘Š"""

async def calculate_recommendation_score(
    sector_analysis: dict,
    company_analysis: dict,
    technical_analysis: dict
) -> float
    """è®¡ç®—ç»¼åˆæ¨èè¯„åˆ†ï¼ˆ0-10ï¼‰"""

async def save_to_database(
    code: str,
    score: float,
    reason: str,
    detail: dict
) -> bool
    """å°†åˆ†æç»“æœå†™å…¥ stock_analysis_results è¡¨"""
```

**è¯„åˆ†ç®—æ³•**ï¼š
```python
ç»¼åˆè¯„åˆ† = (
    æ¿å—è¯„åˆ† Ã— 0.35 +
    å…¬å¸è¯„åˆ† Ã— 0.35 +
    æŠ€æœ¯è¯„åˆ† Ã— 0.30
)

æ¿å—è¯„åˆ†ï¼ˆ0-10ï¼‰ï¼š
  - æ¿å—çƒ­åº¦å‡å€¼ï¼ˆ0-10ï¼‰Ã— 0.5
  - æ”¿ç­–æ”¯æŒåŠ›åº¦ï¼ˆå¼º:10, ä¸­:6, å¼±:3ï¼‰Ã— 0.3
  - æ¿å—è¶‹åŠ¿ï¼ˆä¸Šå‡:10, éœ‡è¡:6, ä¸‹é™:2ï¼‰Ã— 0.2

å…¬å¸è¯„åˆ†ï¼ˆ0-10ï¼‰ï¼š
  - å‚¬åŒ–å‰‚æ•°é‡ï¼ˆâ‰¥3:10, 2:7, 1:4, 0:0ï¼‰Ã— 0.4
  - è´¢åŠ¡å¥åº·åº¦ï¼ˆä¼˜ç§€:10, è‰¯å¥½:8, ä¸­ç­‰:5, è¾ƒå·®:2ï¼‰Ã— 0.3
  - æœ€æ–°åŠ¨æ€å½±å“ï¼ˆæ­£é¢:10, ä¸­æ€§:6, è´Ÿé¢:2ï¼‰Ã— 0.3

æŠ€æœ¯è¯„åˆ†ï¼ˆ0-10ï¼‰ï¼š
  - çªç ´æ¦‚ç‡ï¼ˆ0-1ï¼‰Ã— 10 Ã— 0.6
  - å½¢æ€æˆç†Ÿåº¦ï¼ˆæœ«æœŸ:10, ä¸­æœŸ:6, æ—©æœŸ:3ï¼‰Ã— 0.2
  - æˆäº¤é‡è¶‹åŠ¿ï¼ˆæ”¾é‡:10, å¹³ç¨³:6, ç¼©é‡:3ï¼‰Ã— 0.2
```

**æŠ¥å‘Šæ¨¡æ¿**ï¼š
```markdown
# {code} {name} æŠ•èµ„åˆ†ææŠ¥å‘Š

ç”Ÿæˆæ—¶é—´ï¼š{datetime}
åˆ†ææ¨¡å‹ï¼šanalysis_llm v1.0 (MAF python-1.0.0b260130)

---

## ğŸ“Š åŸºæœ¬ä¿¡æ¯
- **å½“å‰ä»·æ ¼**ï¼š{current_price} å…ƒ
- **å†å²å³°å€¼**ï¼š{peak_price} å…ƒï¼ˆ{peak_time}ï¼‰
- **éœ‡è¡æ—¶é•¿**ï¼š{oscillation_months} ä¸ªæœˆ
- **å›æ’¤å¹…åº¦**ï¼š{drawdown_pct}%

---

## ğŸ” å¹³åº•é”…å½¢æ€åˆ†æ
- **å½¢æ€æˆç†Ÿåº¦**ï¼š{maturity}ï¼ˆæœ«æœŸ/ä¸­æœŸ/æ—©æœŸï¼‰
- **ç®±ä½“åŒºé—´**ï¼š{support_level} - {resistance_level} å…ƒ
- **å½“å‰ä½ç½®**ï¼š{position}ï¼ˆç®±ä½“{price_position_pct}%ï¼‰
- **æ³¢åŠ¨ç‡æ”¶æ•›**ï¼š{volatility_ratio}ï¼ˆ<1 è¡¨ç¤ºæ”¶æ•›ï¼‰
- **æˆäº¤é‡è¶‹åŠ¿**ï¼š{volume_trend}

**åˆ†æç»“è®º**ï¼š{pattern_conclusion}

---

## ğŸ“ˆ æ¿å—åˆ†æï¼ˆæƒé‡35%ï¼‰
### æ‰€å±æ¿å—
{for sector in sectors}
- **{sector.name}**ï¼ˆ{sector.type}ï¼‰
  - çƒ­åº¦è¯„åˆ†ï¼š{sector.hotness_score}/10
  - è¶‹åŠ¿ï¼š{sector.trend}
  - æ”¿ç­–æ”¯æŒï¼š{sector.policy_support}
  - å…³é”®å‚¬åŒ–å‰‚ï¼š{sector.key_catalysts}
{endfor}

### æ¿å—ç»¼åˆè¯„ä¼°
- **å¹³å‡çƒ­åº¦**ï¼š{avg_hotness}/10
- **æ”¿ç­–æ”¯æŒ**ï¼š{policy_support_level}
- **æ¿å—å¾—åˆ†**ï¼š{sector_score}/10

**åˆ†æç»“è®º**ï¼š{sector_conclusion}

---

## ğŸ¢ å…¬å¸åŸºæœ¬é¢åˆ†æï¼ˆæƒé‡35%ï¼‰
### è¡Œä¸šåœ°ä½
- {industry_position}
- å¸‚å€¼ï¼š{market_cap}

### æœ€è¿‘6ä¸ªæœˆé‡å¤§äº‹ä»¶
{for news in recent_news}
- **{news.date}**ï¼š{news.title}ï¼ˆå½±å“ï¼š{news.impact}ï¼‰
{endfor}

### å‚¬åŒ–å‰‚è¯†åˆ«
{for catalyst in catalysts}
- {catalyst}
{endfor}

### é£é™©å› ç´ 
{for risk in risks}
- {risk}
{endfor}

### å…¬å¸ç»¼åˆè¯„ä¼°
- **è´¢åŠ¡å¥åº·åº¦**ï¼š{financial_health}
- **å‚¬åŒ–å‰‚æ•°é‡**ï¼š{catalysts_count}
- **å…¬å¸å¾—åˆ†**ï¼š{company_score}/10

**åˆ†æç»“è®º**ï¼š{company_conclusion}

---

## ğŸ“‰ æŠ€æœ¯åˆ†æï¼ˆæƒé‡30%ï¼‰
### å…³é”®ä»·ä½
- **æ”¯æ’‘ä½**ï¼š{support_level} å…ƒ
- **é˜»åŠ›ä½**ï¼š{resistance_level} å…ƒ
- **å½“å‰ä»·**ï¼š{current_price} å…ƒ

### çªç ´åˆ†æ
- **çªç ´æ¦‚ç‡**ï¼š{breakout_probability}%
- **6ä¸ªæœˆç›®æ ‡ä»·**ï¼š{target_price} å…ƒï¼ˆæ½œåœ¨æ¶¨å¹… {upside_pct}%ï¼‰
- **æ­¢æŸä½**ï¼š{stop_loss} å…ƒ

### æŠ€æœ¯ç»¼åˆè¯„ä¼°
- **æŠ€æœ¯å¾—åˆ†**ï¼š{technical_score}/10

**åˆ†æç»“è®º**ï¼š{technical_conclusion}

---

## ğŸ’¡ ç»¼åˆè¯„ä¼°

### æ¨èè¯„åˆ†
**{recommendation_score}/10** {score_emoji}

### è¯„åˆ†æ„æˆ
- æ¿å—è¯„åˆ†ï¼š{sector_score}/10ï¼ˆæƒé‡35%ï¼‰
- å…¬å¸è¯„åˆ†ï¼š{company_score}/10ï¼ˆæƒé‡35%ï¼‰
- æŠ€æœ¯è¯„åˆ†ï¼š{technical_score}/10ï¼ˆæƒé‡30%ï¼‰

### æ¨èç†ç”±ï¼ˆæ ¸å¿ƒé€»è¾‘ï¼‰
{recommendation_reason}

### é£é™©æç¤º
{risk_warnings}

### æ“ä½œå»ºè®®
{if score >= 7.5}
**å¼ºçƒˆæ¨è**ï¼šå»ºè®®ç§¯æå…³æ³¨ï¼Œç­‰å¾…çªç ´ä¿¡å·ååˆ†æ‰¹å»ºä»“
{elif score >= 6.0}
**è°¨æ…æ¨è**ï¼šå­˜åœ¨ä¸Šæ¶¨æ½œåŠ›ï¼Œä½†éœ€å¯†åˆ‡å…³æ³¨å‚¬åŒ–å‰‚å…‘ç°æƒ…å†µ
{elif score >= 4.0}
**ä¸­æ€§**ï¼šå¯è§‚æœ›ï¼Œç­‰å¾…æ›´æ˜ç¡®ä¿¡å·
{else}
**ä¸æ¨è**ï¼šé£é™©è¾ƒé«˜æˆ–ä¸Šæ¶¨æ¦‚ç‡è¾ƒä½ï¼Œå»ºè®®å›é¿
{endif}

---

## ğŸ“Œ åˆ†æè¯´æ˜
- **åˆ†ææ—¶é—´**ï¼š{analysis_time}
- **æ•°æ®æ¥æº**ï¼šPostgreSQL æ•°æ®åº“ + Web Search
- **åˆ†ææ¨¡å‹**ï¼šMAF Magentic å¤š Agent åä½œ
- **å…è´£å£°æ˜**ï¼šæœ¬æŠ¥å‘Šç”± AI ç”Ÿæˆï¼Œä»…ä¾›å‚è€ƒï¼Œä¸æ„æˆæŠ•èµ„å»ºè®®ã€‚æŠ•èµ„æœ‰é£é™©ï¼Œå…¥å¸‚éœ€è°¨æ…ã€‚

---
*Powered by analysis_llm v1.0 | Microsoft Agent Framework python-1.0.0b260130*
```

**System Message è¦ç‚¹**ï¼š
- æŠ¥å‘Šå¿…é¡»å®Œæ•´ï¼ˆä¸èƒ½ç¼ºå°‘ä»»ä½•ç« èŠ‚ï¼‰
- æ¨èç†ç”±éœ€ç®€æ˜æ‰¼è¦ï¼ˆ50å­—ä»¥å†…ï¼Œçªå‡ºæ ¸å¿ƒé€»è¾‘ï¼‰
- è¯„åˆ†è®¡ç®—éœ€ä¸¥æ ¼æŒ‰ç…§ç®—æ³•ï¼Œå¹¶åœ¨æŠ¥å‘Šä¸­å±•ç¤ºè®¡ç®—è¿‡ç¨‹
- æœ€ç»ˆå¿…é¡»è°ƒç”¨ `save_to_database` å°†ç»“æœå†™å…¥æ•°æ®åº“

---

## 4. Magentic Workflow å®ç°

### 4.1 æ ¸å¿ƒä»£ç ç»“æ„

**æ–‡ä»¶ç»„ç»‡**ï¼š
```
analysis_llm/
â”œâ”€â”€ __init__.py
â”œâ”€â”€ config.py                 # é…ç½®ç®¡ç†
â”œâ”€â”€ agents/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ manager.py            # Manager Agent å®šä¹‰
â”‚   â”œâ”€â”€ stock_data_agent.py
â”‚   â”œâ”€â”€ sector_research_agent.py
â”‚   â”œâ”€â”€ company_research_agent.py
â”‚   â”œâ”€â”€ technical_analyst_agent.py
â”‚   â””â”€â”€ report_writer_agent.py
â”œâ”€â”€ tools/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ database_tools.py     # æ•°æ®åº“å·¥å…·å‡½æ•°
â”‚   â”œâ”€â”€ web_search_tools.py   # Web Search å°è£…
â”‚   â”œâ”€â”€ technical_tools.py    # æŠ€æœ¯æŒ‡æ ‡è®¡ç®—
â”‚   â””â”€â”€ vision_tools.py       # å›¾åƒåˆ†æï¼ˆå¯é€‰ï¼‰
â”œâ”€â”€ models/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â””â”€â”€ schemas.py            # Pydantic æ•°æ®æ¨¡å‹
â”œâ”€â”€ database/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ connection.py         # æ•°æ®åº“è¿æ¥æ± 
â”‚   â””â”€â”€ queries.py            # SQL æŸ¥è¯¢
â”œâ”€â”€ main.py                   # ä¸»å…¥å£
â”œâ”€â”€ analyzer.py               # StockAnalyzer ç±»
â””â”€â”€ utils/
    â”œâ”€â”€ __init__.py
    â”œâ”€â”€ logger.py             # æ—¥å¿—é…ç½®
    â””â”€â”€ prompts.py            # æç¤ºè¯æ¨¡æ¿
```

### 4.2 Workflow æ„å»ºä»£ç 

```python
# analyzer.py
from agent_framework import (
    MagenticBuilder,
    ChatAgent,
    StandardMagenticManager,
    WorkflowOutputEvent,
    RequestInfoEvent,
    AgentRunUpdateEvent
)
from agent_framework.openai import OpenAIChatClient
import asyncio
from typing import Optional, Dict, Any

from .config import Config
from .agents import (
    create_manager_agent,
    create_stock_data_agent,
    create_sector_research_agent,
    create_company_research_agent,
    create_technical_analyst_agent,
    create_report_writer_agent
)
from .database import DatabaseManager

class StockAnalyzer:
    def __init__(self, config: Config):
        self.config = config
        self.db_manager = DatabaseManager(config.database_dsn)
        self.workflow = None
        self.chat_client = None

    async def initialize(self):
        """åˆå§‹åŒ– LLM å®¢æˆ·ç«¯å’Œ Workflow"""
        # 1. åˆå§‹åŒ–æ•°æ®åº“è¿æ¥
        await self.db_manager.connect()

        # 2. åˆå§‹åŒ– LLM å®¢æˆ·ç«¯
        self.chat_client = OpenAIChatClient(
            model=self.config.llm_model_manager,  # GPT-4o for Manager
            api_key=self.config.openai_api_key,
            temperature=self.config.temperature_manager
        )

        # 3. åˆ›å»º Worker Agents
        stock_data_agent = create_stock_data_agent(
            self.chat_client,
            self.db_manager
        )

        sector_research_agent = create_sector_research_agent(
            self.chat_client,
            self.config.web_search_api_key
        )

        company_research_agent = create_company_research_agent(
            self.chat_client,
            self.config.web_search_api_key
        )

        technical_analyst_agent = create_technical_analyst_agent(
            self.chat_client,
            self.db_manager,
            self.config.kline_image_dir
        )

        report_writer_agent = create_report_writer_agent(
            self.chat_client,
            self.db_manager
        )

        # 4. åˆ›å»º Manager Agent
        manager_agent = create_manager_agent(self.chat_client)

        # 5. æ„å»º Magentic Workflow
        self.workflow = (
            MagenticBuilder()
            .participants(
                stock_data_agent,
                sector_research_agent,
                company_research_agent,
                technical_analyst_agent,
                report_writer_agent
            )
            .with_standard_manager(
                agent=manager_agent,
                max_stall_count=self.config.max_stall_count,
                max_reset_count=self.config.max_reset_count
            )
            .with_plan_review(enable=self.config.enable_plan_review)
            .build()
        )

        print("âœ“ StockAnalyzer åˆå§‹åŒ–å®Œæˆ")

    async def analyze_stock(self, stock_code: str) -> Optional[Dict[str, Any]]:
        """åˆ†æå•æ”¯è‚¡ç¥¨"""
        print(f"\n{'='*60}")
        print(f"å¼€å§‹åˆ†æè‚¡ç¥¨: {stock_code}")
        print(f"åˆ†ææ—¶é—´: {datetime.now().strftime('%Y-%m-%d %H:%M:%S')}")
        print(f"{'='*60}\n")

        # æ„å»ºä»»åŠ¡æè¿°
        task = f"""
è¯·åˆ†æè‚¡ç¥¨ {stock_code}ï¼Œåˆ¤æ–­å…¶æ˜¯å¦å€¼å¾—è´­ä¹°ã€‚è¯¥è‚¡ç¥¨å·²è¢«åˆæ­¥ç­›é€‰ï¼Œå…·æœ‰"å¹³åº•é”…"ç‰¹å¾ï¼ˆæ›¾ç»é«˜ä¼ï¼Œåé•¿æœŸçª„å¹…éœ‡è¡ï¼‰ã€‚

ä½ éœ€è¦åè°ƒå„ä¸“å®¶ Agent å®Œæˆä»¥ä¸‹å·¥ä½œï¼š
1. ã€StockDataAgentã€‘ä»æ•°æ®åº“è·å–è¯¥è‚¡ç¥¨çš„æœˆKçº¿æ•°æ®ï¼ˆè‡³å°‘12ä¸ªæœˆï¼‰
2. ã€StockDataAgentã€‘è¯†åˆ«è‚¡ç¥¨çš„å¹³åº•é”…å½¢æ€ç‰¹å¾ï¼ˆå³°å€¼ã€éœ‡è¡æ—¶é•¿ã€æ³¢åŠ¨ç‡ç­‰ï¼‰
3. ã€SectorResearchAgentã€‘æœç´¢è¯¥è‚¡ç¥¨æ‰€å±çš„ä¸»è¦æ¿å—å’Œæ¦‚å¿µæ¿å—ï¼ˆè‡³å°‘3ä¸ªï¼‰
4. ã€SectorResearchAgentã€‘æ·±åº¦åˆ†æå„æ¿å—æœ€è¿‘3-6ä¸ªæœˆçš„çƒ­åº¦ã€è¶‹åŠ¿ã€æ”¿ç­–æ”¯æŒ
5. ã€CompanyResearchAgentã€‘æœç´¢å…¬å¸æœ€è¿‘6ä¸ªæœˆçš„é‡å¤§äº‹ä»¶ã€è´¢æŠ¥ã€å‚¬åŒ–å‰‚
6. ã€CompanyResearchAgentã€‘è¯„ä¼°å…¬å¸åœ¨è¡Œä¸šä¸­çš„ç«äº‰åœ°ä½å’Œè´¢åŠ¡å¥åº·åº¦
7. ã€TechnicalAnalystAgentã€‘åŸºäºKçº¿æ•°æ®ï¼ˆæˆ–PNGå›¾åƒï¼‰è¿›è¡ŒæŠ€æœ¯åˆ†æ
8. ã€TechnicalAnalystAgentã€‘è®¡ç®—æ”¯æ’‘/é˜»åŠ›ä½ï¼Œè¯„ä¼°6ä¸ªæœˆå†…çªç ´æ¦‚ç‡
9. ã€ReportWriterAgentã€‘ç»¼åˆæ‰€æœ‰ä¿¡æ¯ï¼Œç”ŸæˆMarkdownåˆ†ææŠ¥å‘Š
10. ã€ReportWriterAgentã€‘è®¡ç®—æ¨èè¯„åˆ†ï¼ˆ0-10ï¼‰ï¼Œå¹¶å°†ç»“æœå†™å…¥æ•°æ®åº“

é‡ç‚¹å…³æ³¨ï¼š
- å¹³åº•é”…å½¢æ€æ˜¯å¦æˆç†Ÿï¼ˆéœ‡è¡æ—¶é•¿ã€æ³¢åŠ¨ç‡æ”¶æ•›ï¼‰
- æ¿å—æ˜¯å¦æœ‰å‚¬åŒ–å‰‚ï¼ˆæ”¿ç­–ã€çƒ­ç‚¹ã€æ‹ç‚¹ï¼‰
- å…¬å¸æ˜¯å¦æœ‰åˆ©å¥½äº‹ä»¶ï¼ˆè´¢æŠ¥ã€è®¢å•ã€é‡ç»„ã€ç®¡ç†å±‚å˜åŠ¨ï¼‰
- æŠ€æœ¯é¢æ˜¯å¦å…·å¤‡çªç ´æ¡ä»¶ï¼ˆæˆäº¤é‡ã€ä»·æ ¼ä½ç½®ï¼‰

æœ€ç»ˆç»™å‡ºï¼š
- æ¨èè¯„åˆ†ï¼ˆ0-10åˆ†ï¼Œä¿ç•™1ä½å°æ•°ï¼‰
- æ¨èç†ç”±ï¼ˆ50å­—ä»¥å†…ï¼Œçªå‡ºæ ¸å¿ƒé€»è¾‘ï¼‰
- è¯¦ç»†çš„MarkdownæŠ¥å‘Š
"""

        pending_responses = None
        output_event = None

        # äº‹ä»¶é©±åŠ¨å¾ªç¯
        while not output_event:
            if pending_responses:
                stream = self.workflow.send_responses_streaming(pending_responses)
            else:
                stream = self.workflow.run_stream(task)

            pending_responses = None

            async for event in stream:
                # å®æ—¶æ˜¾ç¤º Agent è¾“å‡º
                if isinstance(event, AgentRunUpdateEvent):
                    if event.data.text:
                        print(f"[{event.executor_id}]: {event.data.text}", end="", flush=True)

                # äººå·¥è®¡åˆ’å®¡æŸ¥ï¼ˆå¦‚æœå¯ç”¨ï¼‰
                elif isinstance(event, RequestInfoEvent):
                    if hasattr(event.data, 'plan'):
                        print("\n\n" + "="*60)
                        print("ã€Manager æå‡ºçš„æ‰§è¡Œè®¡åˆ’ - éœ€è¦æ‚¨çš„å®¡æ‰¹ã€‘")
                        print("="*60)
                        print(event.data.plan.text)
                        print("="*60 + "\n")

                        if self.config.auto_approve_plan:
                            response = event.data.approve()
                            print("âœ“ è®¡åˆ’å·²è‡ªåŠ¨æ‰¹å‡†\n")
                        else:
                            user_input = input("è¯·è¾“å…¥ (å›è½¦=æ‰¹å‡†, æ–‡å­—=ä¿®æ”¹æ„è§, 'q'=å–æ¶ˆ): ")

                            if user_input.strip().lower() == 'q':
                                print("âœ— åˆ†æå·²å–æ¶ˆ\n")
                                return None
                            elif user_input.strip() == "":
                                response = event.data.approve()
                                print("âœ“ è®¡åˆ’å·²æ‰¹å‡†\n")
                            else:
                                response = event.data.revise(user_input)
                                print("âœ“ è®¡åˆ’å·²ä¿®æ”¹ï¼Œé‡æ–°ç”Ÿæˆä¸­...\n")

                        pending_responses = {event.request_id: response}

                # ä»»åŠ¡å®Œæˆ
                elif isinstance(event, WorkflowOutputEvent):
                    output_event = event
                    print("\n\n" + "#"*60)
                    print("åˆ†æå®Œæˆï¼")
                    print("#"*60)

                    # è§£æè¾“å‡º
                    result = self._parse_output(event.data)
                    return result

        return None

    def _parse_output(self, output: str) -> Dict[str, Any]:
        """è§£æ Workflow è¾“å‡º"""
        # ä»è¾“å‡ºä¸­æå–è¯„åˆ†å’Œç†ç”±
        # ï¼ˆReportWriterAgent åº”è¯¥è¿”å›ç»“æ„åŒ–æ•°æ®ï¼‰
        # è¿™é‡Œç®€åŒ–å¤„ç†ï¼Œå®é™…åº”ä½¿ç”¨ JSON æˆ– Pydantic
        return {
            "success": True,
            "message": "åˆ†æå®Œæˆ",
            "output": output
        }

    async def batch_analyze(
        self,
        stock_codes: list[str],
        delay_seconds: int = 5
    ) -> Dict[str, Any]:
        """æ‰¹é‡åˆ†æå¤šæ”¯è‚¡ç¥¨"""
        results = {}

        for i, code in enumerate(stock_codes, 1):
            print(f"\n{'='*60}")
            print(f"æ‰¹é‡åˆ†æè¿›åº¦: {i}/{len(stock_codes)}")
            print(f"{'='*60}")

            try:
                result = await self.analyze_stock(code)
                results[code] = result
                print(f"âœ“ {code} åˆ†æå®Œæˆ")
            except Exception as e:
                print(f"âœ— {code} åˆ†æå¤±è´¥: {e}")
                results[code] = {"success": False, "error": str(e)}

            # å»¶è¿Ÿä»¥é¿å… API é™æµ
            if i < len(stock_codes):
                print(f"\nç­‰å¾… {delay_seconds} ç§’åç»§ç»­...\n")
                await asyncio.sleep(delay_seconds)

        return results

    async def close(self):
        """å…³é—­èµ„æº"""
        await self.db_manager.close()
        print("âœ“ èµ„æºå·²é‡Šæ”¾")
```

### 4.3 Agent åˆ›å»ºç¤ºä¾‹

```python
# agents/sector_research_agent.py
from agent_framework import ChatAgent
from agent_framework.openai import OpenAIChatClient
from ..tools.web_search_tools import create_web_search_tools

def create_sector_research_agent(
    chat_client: OpenAIChatClient,
    web_search_api_key: str
) -> ChatAgent:

    system_message = """
ä½ æ˜¯æ¿å—ç ”ç©¶ä¸“å®¶ï¼Œè´Ÿè´£åˆ†æè‚¡ç¥¨æ‰€å±æ¿å—çš„çƒ­åº¦ã€è¶‹åŠ¿å’Œæ”¿ç­–æ”¯æŒã€‚

å·¥ä½œæµç¨‹ï¼š
1. ä½¿ç”¨ web_search å·¥å…·æœç´¢è‚¡ç¥¨æ‰€å±çš„ä¸»è¦æ¿å—å’Œæ¦‚å¿µæ¿å—ï¼ˆè‡³å°‘3ä¸ªï¼‰
   - æŸ¥è¯¢è¯ï¼š"{stock_name} æ‰€å±æ¿å— æ¦‚å¿µæ¿å— 2025 2026"
   - ç›®æ ‡ï¼šè¯†åˆ«ä¸»æ¿å—ï¼ˆè¡Œä¸šåˆ†ç±»ï¼‰å’Œæ¦‚å¿µæ¿å—ï¼ˆé¢˜æã€çƒ­ç‚¹ï¼‰

2. å¯¹æ¯ä¸ªæ¿å—è¿›è¡Œæ·±åº¦åˆ†æï¼š
   a. æ¿å—çƒ­åº¦ï¼šæœç´¢æœ€è¿‘6ä¸ªæœˆçš„æ–°é—»æ•°é‡ã€æåŠé¢‘ç‡
      - æŸ¥è¯¢è¯ï¼š"{sector} æ¿å— æœ€è¿‘6ä¸ªæœˆ è¶‹åŠ¿ æ–°é—» çƒ­ç‚¹"
      - è¯„åˆ†ï¼š0-10åˆ†ï¼ˆæ–°é—»é‡ã€æ­£é¢æåŠã€èµ„é‡‘æµå…¥ç­‰ç»¼åˆåˆ¤æ–­ï¼‰

   b. æ¿å—è¶‹åŠ¿ï¼šåˆ¤æ–­ä¸Šå‡/éœ‡è¡/ä¸‹é™
      - æŸ¥è¯¢è¯ï¼š"{sector} æ¿å— èµ°åŠ¿ è¶‹åŠ¿ 2025 2026"
      - ä¾æ®ï¼šè¡Œä¸šæ™¯æ°”åº¦ã€é¾™å¤´è‚¡è¡¨ç°ã€å¸‚åœºå…³æ³¨åº¦

   c. æ”¿ç­–æ”¯æŒï¼šæœç´¢å›½å®¶/åœ°æ–¹æ”¿ç­–
      - æŸ¥è¯¢è¯ï¼š"{sector} æ”¿ç­–æ”¯æŒ 2025 2026 å›½å®¶æ”¿ç­–"
      - è¯„çº§ï¼šå¼º/ä¸­/å¼±

3. å¯¹æ¯”åŒæ¿å—é¾™å¤´è‚¡çš„è¡¨ç°
   - æŸ¥è¯¢è¯ï¼š"{sector} é¾™å¤´è‚¡ æ’å å¸‚å€¼"
   - ç›®æ ‡ï¼šè¯„ä¼°ç›®æ ‡è‚¡ç¥¨åœ¨æ¿å—ä¸­çš„åœ°ä½

è¾“å‡ºæ ¼å¼ï¼ˆJSONï¼‰ï¼š
{
  "sectors": [
    {
      "name": "æ¿å—åç§°",
      "type": "ä¸»æ¿å—/æ¦‚å¿µæ¿å—",
      "hotness_score": 8.5,
      "trend": "ä¸Šå‡/éœ‡è¡/ä¸‹é™",
      "policy_support": "å¼º/ä¸­/å¼±",
      "news_count_6m": 150,
      "key_catalysts": ["å‚¬åŒ–å‰‚1", "å‚¬åŒ–å‰‚2"]
    }
  ],
  "overall_assessment": "ç»¼åˆè¯„ä¼°"
}

è´¨é‡æ ‡å‡†ï¼š
- è‡³å°‘è¯†åˆ«3ä¸ªæ¿å—
- æ¯ä¸ªæ¿å—å¿…é¡»ç»™å‡ºçƒ­åº¦è¯„åˆ†ï¼ˆ0-10ï¼‰
- å¿…é¡»æ˜ç¡®æ”¿ç­–æ”¯æŒåŠ›åº¦
- å¿…é¡»åˆ—ä¸¾å…³é”®å‚¬åŒ–å‰‚
"""

    tools = create_web_search_tools(web_search_api_key)

    return ChatAgent(
        name="SectorResearchAgent",
        description="è´Ÿè´£ä½¿ç”¨ web_search å·¥å…·æœç´¢è‚¡ç¥¨æ‰€å±æ¿å—ï¼Œåˆ†ææ¿å—çƒ­åº¦ã€è¶‹åŠ¿ã€æ”¿ç­–æ”¯æŒå’Œé¾™å¤´è‚¡å¯¹æ¯”",
        model=chat_client,
        system_message=system_message,
        tools=tools
    )
```

---

## 5. Web Search å·¥å…·è®¾è®¡

### 5.1 å·¥å…·é€‰å‹

æ¨èä½¿ç”¨ä»¥ä¸‹ Web Search APIï¼š

| å·¥å…· | ä¼˜ç‚¹ | ç¼ºç‚¹ | æ¨èåœºæ™¯ |
|------|------|------|----------|
| **Tavily API** | ä¸“ä¸º LLM ä¼˜åŒ–ï¼Œç»“æœå¹²å‡€ | éœ€ä»˜è´¹ | ç”Ÿäº§ç¯å¢ƒ |
| **Serper API** | ä¾¿å®œï¼Œå¿«é€Ÿ | ç»“æœéœ€äºŒæ¬¡æ¸…æ´— | æˆæœ¬æ•æ„Ÿé¡¹ç›® |
| **Google Custom Search** | å®˜æ–¹ APIï¼Œç»“æœæƒå¨ | å…è´¹é¢åº¦å°‘ | å¼€å‘æµ‹è¯• |
| **DuckDuckGoï¼ˆå…è´¹ï¼‰** | æ— éœ€ API Key | ä¸ç¨³å®šï¼Œæ˜“è¢«é™æµ | åŸå‹é˜¶æ®µ |

**æ¨èé…ç½®**ï¼šTavily APIï¼ˆç”Ÿäº§ï¼‰+ DuckDuckGoï¼ˆå¼€å‘æµ‹è¯•ï¼‰

### 5.2 Tavily API å°è£…

```python
# tools/web_search_tools.py
import httpx
from agent_framework import Tool
from typing import List, Dict, Any

class TavilySearchTool:
    def __init__(self, api_key: str):
        self.api_key = api_key
        self.base_url = "https://api.tavily.com/search"
        self.client = httpx.AsyncClient(timeout=30.0)

    async def search(
        self,
        query: str,
        max_results: int = 5,
        search_depth: str = "basic"  # "basic" or "advanced"
    ) -> List[Dict[str, Any]]:
        """
        æ‰§è¡Œ Web æœç´¢

        Args:
            query: æœç´¢æŸ¥è¯¢è¯
            max_results: æœ€å¤šè¿”å›ç»“æœæ•°
            search_depth: æœç´¢æ·±åº¦ï¼ˆbasic=å¿«é€Ÿ, advanced=æ·±åº¦ï¼‰

        Returns:
            æœç´¢ç»“æœåˆ—è¡¨ï¼Œæ¯ä¸ªç»“æœåŒ…å«ï¼š
            - title: æ ‡é¢˜
            - url: é“¾æ¥
            - content: æ‘˜è¦å†…å®¹
            - score: ç›¸å…³æ€§è¯„åˆ†
        """
        payload = {
            "api_key": self.api_key,
            "query": query,
            "max_results": max_results,
            "search_depth": search_depth,
            "include_answer": True,  # åŒ…å« AI æ€»ç»“
            "include_raw_content": False  # ä¸éœ€è¦å®Œæ•´HTML
        }

        response = await self.client.post(self.base_url, json=payload)
        response.raise_for_status()

        data = response.json()

        return {
            "answer": data.get("answer", ""),  # AI æ€»ç»“
            "results": data.get("results", [])
        }

    async def close(self):
        await self.client.aclose()

def create_web_search_tools(api_key: str) -> List[Tool]:
    """åˆ›å»º Web Search å·¥å…·"""
    tavily = TavilySearchTool(api_key)

    async def web_search(query: str, max_results: int = 5) -> str:
        """
        æœç´¢äº’è”ç½‘ä¿¡æ¯

        Args:
            query: æœç´¢æŸ¥è¯¢è¯ï¼ˆä¸­æ–‡æˆ–è‹±æ–‡ï¼‰
            max_results: æœ€å¤šè¿”å›ç»“æœæ•°ï¼ˆé»˜è®¤5ï¼‰

        Returns:
            æœç´¢ç»“æœçš„æ–‡æœ¬æ‘˜è¦
        """
        result = await tavily.search(query, max_results)

        # æ ¼å¼åŒ–è¾“å‡º
        output = f"æœç´¢æŸ¥è¯¢ï¼š{query}\n\n"

        if result["answer"]:
            output += f"AI æ€»ç»“ï¼š\n{result['answer']}\n\n"

        output += "æœç´¢ç»“æœï¼š\n"
        for i, item in enumerate(result["results"], 1):
            output += f"{i}. {item['title']}\n"
            output += f"   {item['content'][:200]}...\n"
            output += f"   æ¥æºï¼š{item['url']}\n\n"

        return output

    return [
        Tool(
            function=web_search,
            name="web_search",
            description="æœç´¢äº’è”ç½‘è·å–æœ€æ–°ä¿¡æ¯ï¼ˆæ–°é—»ã€æ”¿ç­–ã€å…¬å¸åŠ¨æ€ã€æ¿å—çƒ­åº¦ç­‰ï¼‰"
        )
    ]
```

### 5.3 æœç´¢ç­–ç•¥ä¸æŸ¥è¯¢è¯è®¾è®¡

**æœ€ä½³å®è·µ**ï¼š

1. **æŸ¥è¯¢è¯è¦å…·ä½“**ï¼š
   - âŒ "é“¶è¡Œæ¿å—"
   - âœ… "é“¶è¡Œæ¿å— æœ€è¿‘6ä¸ªæœˆ è¶‹åŠ¿ æ–°é—» 2025 2026"

2. **åŒ…å«æ—¶é—´èŒƒå›´**ï¼š
   - åŠ å…¥"2025"ã€"2026"ã€"æœ€è¿‘6ä¸ªæœˆ"ç­‰å…³é”®è¯
   - é¿å…æœç´¢åˆ°è¿‡æ—¶ä¿¡æ¯

3. **ä¸­è‹±æ–‡æ··åˆ**ï¼š
   - å¯¹äºå›½é™…å…¬å¸ï¼Œå°è¯•è‹±æ–‡æœç´¢
   - ç¤ºä¾‹ï¼š"Apple Inc financial report Q4 2025"

4. **æœç´¢æ¬¡æ•°é™åˆ¶**ï¼š
   - æ¯ä¸ª Agent æœ€å¤šæœç´¢ 5 æ¬¡ï¼ˆé¿å… Token æµªè´¹ï¼‰
   - Manager åº”ç›‘æ§æœç´¢æ¬¡æ•°ï¼Œè¶…é™æ—¶æé†’

5. **ç»“æœéªŒè¯**ï¼š
   - äº¤å‰éªŒè¯ï¼šä»å¤šä¸ªæ¥æºç¡®è®¤å…³é”®ä¿¡æ¯
   - æ—¶æ•ˆæ€§æ£€æŸ¥ï¼šå¿½ç•¥è¶…è¿‡ 6 ä¸ªæœˆçš„æ–°é—»

---

## 6. æ•°æ®åº“è®¾è®¡

### 6.1 è¾“å…¥è¡¨ï¼ˆå·²å­˜åœ¨ï¼‰

#### stock_monthly_klineï¼ˆæœˆKçº¿æ•°æ®ï¼‰
```sql
-- å·²å­˜åœ¨ï¼Œæ— éœ€ä¿®æ”¹
CREATE TABLE stock_monthly_kline (
    month TIMESTAMP NOT NULL,
    code VARCHAR(20) NOT NULL,
    name VARCHAR(100),
    open NUMERIC(10, 2),
    high NUMERIC(10, 2),
    low NUMERIC(10, 2),
    close NUMERIC(10, 2),
    volume BIGINT,
    amount NUMERIC(15, 2),
    PRIMARY KEY (code, month)
);
```

#### stock_flatbottom_preselectï¼ˆå¹³åº•é”…é¢„ç­›é€‰ç»“æœï¼‰
```sql
-- å·²å­˜åœ¨ï¼Œæ— éœ€ä¿®æ”¹
CREATE TABLE stock_flatbottom_preselect (
    code VARCHAR(20) PRIMARY KEY,
    name VARCHAR(100),
    current_price NUMERIC(10, 2),
    history_high NUMERIC(10, 2),
    glory_ratio NUMERIC(10, 2),
    glory_type VARCHAR(20),
    drawdown_pct NUMERIC(10, 2),
    box_range_pct NUMERIC(10, 2),
    volatility_ratio NUMERIC(10, 4),
    price_position NUMERIC(10, 4),
    slope NUMERIC(10, 6),
    r_squared NUMERIC(10, 4),
    score NUMERIC(10, 2),
    screening_preset VARCHAR(20),
    created_at TIMESTAMP DEFAULT NOW(),
    updated_at TIMESTAMP DEFAULT NOW()
);
```

### 6.2 è¾“å‡ºè¡¨ï¼ˆæ–°å»ºï¼‰

#### stock_analysis_resultsï¼ˆåˆ†æç»“æœè¡¨ï¼‰
```sql
CREATE TABLE IF NOT EXISTS stock_analysis_results (
    id SERIAL PRIMARY KEY,

    -- è‚¡ç¥¨åŸºæœ¬ä¿¡æ¯
    code VARCHAR(20) NOT NULL UNIQUE,
    name VARCHAR(100),

    -- æ¨èè¯„åˆ†
    recommendation_score NUMERIC(3,1) CHECK (recommendation_score >= 0 AND recommendation_score <= 10),
    recommendation_reason TEXT NOT NULL,  -- æ¨èç†ç”±ï¼ˆ50å­—ä»¥å†…ï¼‰

    -- åˆ†é¡¹è¯„åˆ†
    sector_score NUMERIC(3,1),            -- æ¿å—è¯„åˆ†
    company_score NUMERIC(3,1),           -- å…¬å¸è¯„åˆ†
    technical_score NUMERIC(3,1),         -- æŠ€æœ¯è¯„åˆ†

    -- è¯¦ç»†åˆ†ææ•°æ®ï¼ˆJSONB æ ¼å¼ï¼‰
    analysis_detail JSONB,

    -- æŠ¥å‘Šæ–‡æœ¬
    report_markdown TEXT,                 -- Markdown æ ¼å¼æŠ¥å‘Š

    -- å…ƒæ•°æ®
    model_version VARCHAR(50) DEFAULT 'analysis_llm-v1.0-maf-b260130',
    created_at TIMESTAMP DEFAULT NOW(),
    updated_at TIMESTAMP DEFAULT NOW(),

    -- å”¯ä¸€çº¦æŸï¼šæ¯ä¸ªè‚¡ç¥¨åªä¿ç•™æœ€æ–°ä¸€æ¬¡åˆ†æ
    CONSTRAINT unique_stock_analysis UNIQUE (code)
);

-- åˆ›å»ºç´¢å¼•
CREATE INDEX idx_analysis_score ON stock_analysis_results(recommendation_score DESC);
CREATE INDEX idx_analysis_created_at ON stock_analysis_results(created_at DESC);
CREATE INDEX idx_analysis_sector_score ON stock_analysis_results(sector_score DESC);

-- æ·»åŠ è¡¨æ³¨é‡Š
COMMENT ON TABLE stock_analysis_results IS 'è‚¡ç¥¨æ·±åº¦åˆ†æç»“æœï¼ˆMAF Magentic å¤šAgentåä½œç”Ÿæˆï¼‰';
COMMENT ON COLUMN stock_analysis_results.recommendation_score IS 'ç»¼åˆæ¨èè¯„åˆ†ï¼ˆ0-10åˆ†ï¼Œ7.5+å¼ºæ¨ï¼Œ6.0-7.5è°¨æ…æ¨èï¼Œ<6ä¸æ¨èï¼‰';
COMMENT ON COLUMN stock_analysis_results.analysis_detail IS 'JSONBæ ¼å¼è¯¦ç»†åˆ†ææ•°æ®ï¼ˆæ¿å—ã€å…¬å¸ã€æŠ€æœ¯åˆ†æçš„åŸå§‹æ•°æ®ï¼‰';
```

#### analysis_detail JSONB å­—æ®µç»“æ„
```json
{
  "stock_data": {
    "current_price": 8.50,
    "peak_price": 25.60,
    "peak_time": "2015-06",
    "oscillation_months": 102,
    "drawdown_pct": -66.8,
    "volatility_ratio": 0.45
  },
  "sector_analysis": {
    "sectors": [
      {
        "name": "é“¶è¡Œ",
        "type": "ä¸»æ¿å—",
        "hotness_score": 6.5,
        "trend": "éœ‡è¡",
        "policy_support": "ä¸­",
        "key_catalysts": ["åˆ©ç‡å¸‚åœºåŒ–", "ä¸è‰¯å¤„ç½®"]
      }
    ],
    "avg_hotness": 7.2,
    "sector_score": 7.5
  },
  "company_analysis": {
    "industry_position": "å…¨å›½è‚¡ä»½åˆ¶é“¶è¡Œç¬¬3å",
    "recent_news": [...],
    "catalysts": ["Q4è´¢æŠ¥è¶…é¢„æœŸ", "å›½ä¼æ”¹é©"],
    "financial_health": "è‰¯å¥½",
    "company_score": 7.0
  },
  "technical_analysis": {
    "support_level": 8.20,
    "resistance_level": 9.50,
    "breakout_probability": 0.65,
    "target_price_6m": 10.50,
    "technical_score": 6.8
  },
  "risk_factors": [
    "æˆ¿åœ°äº§è´·æ¬¾é£é™©",
    "ç»æµä¸‹è¡Œå‹åŠ›"
  ],
  "analyzed_at": "2026-02-02T15:30:00"
}
```

### 6.3 æ•°æ®åº“æ“ä½œå·¥å…·

```python
# database/queries.py
import asyncpg
from typing import Optional, Dict, Any, List
import json
from datetime import datetime

class DatabaseManager:
    def __init__(self, dsn: str):
        self.dsn = dsn
        self.pool: Optional[asyncpg.Pool] = None

    async def connect(self):
        """åˆ›å»ºè¿æ¥æ± """
        self.pool = await asyncpg.create_pool(
            dsn=self.dsn,
            min_size=2,
            max_size=10,
            command_timeout=60
        )
        print("âœ“ æ•°æ®åº“è¿æ¥æ± å·²åˆ›å»º")

    async def close(self):
        """å…³é—­è¿æ¥æ± """
        if self.pool:
            await self.pool.close()

    # ==================== è¯»å–æ“ä½œ ====================

    async def get_stock_kline(
        self,
        code: str,
        months: int = 12
    ) -> List[Dict[str, Any]]:
        """è·å–è‚¡ç¥¨æœˆKçº¿æ•°æ®"""
        query = """
            SELECT month, code, name, open, high, low, close, volume, amount
            FROM stock_monthly_kline
            WHERE code = $1
            ORDER BY month DESC
            LIMIT $2
        """
        async with self.pool.acquire() as conn:
            rows = await conn.fetch(query, code, months)
            return [dict(row) for row in rows]

    async def get_flatbottom_info(self, code: str) -> Optional[Dict[str, Any]]:
        """è·å–å¹³åº•é”…é¢„ç­›é€‰ä¿¡æ¯"""
        query = """
            SELECT *
            FROM stock_flatbottom_preselect
            WHERE code = $1
        """
        async with self.pool.acquire() as conn:
            row = await conn.fetchrow(query, code)
            return dict(row) if row else None

    async def get_stock_basic_info(self, code: str) -> Optional[Dict[str, Any]]:
        """è·å–è‚¡ç¥¨åŸºæœ¬ä¿¡æ¯ï¼ˆä»æœ€æ–°Kçº¿ï¼‰"""
        query = """
            SELECT code, name, close as current_price
            FROM stock_monthly_kline
            WHERE code = $1
            ORDER BY month DESC
            LIMIT 1
        """
        async with self.pool.acquire() as conn:
            row = await conn.fetchrow(query, code)
            return dict(row) if row else None

    # ==================== å†™å…¥æ“ä½œ ====================

    async def save_analysis_result(
        self,
        code: str,
        name: str,
        recommendation_score: float,
        recommendation_reason: str,
        sector_score: float,
        company_score: float,
        technical_score: float,
        analysis_detail: Dict[str, Any],
        report_markdown: str
    ) -> bool:
        """ä¿å­˜åˆ†æç»“æœ"""
        query = """
            INSERT INTO stock_analysis_results (
                code, name,
                recommendation_score, recommendation_reason,
                sector_score, company_score, technical_score,
                analysis_detail, report_markdown,
                created_at, updated_at
            ) VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, NOW(), NOW())
            ON CONFLICT (code)
            DO UPDATE SET
                name = EXCLUDED.name,
                recommendation_score = EXCLUDED.recommendation_score,
                recommendation_reason = EXCLUDED.recommendation_reason,
                sector_score = EXCLUDED.sector_score,
                company_score = EXCLUDED.company_score,
                technical_score = EXCLUDED.technical_score,
                analysis_detail = EXCLUDED.analysis_detail,
                report_markdown = EXCLUDED.report_markdown,
                updated_at = NOW()
        """
        try:
            async with self.pool.acquire() as conn:
                await conn.execute(
                    query,
                    code, name,
                    recommendation_score, recommendation_reason,
                    sector_score, company_score, technical_score,
                    json.dumps(analysis_detail, ensure_ascii=False),
                    report_markdown
                )
            return True
        except Exception as e:
            print(f"ä¿å­˜åˆ†æç»“æœå¤±è´¥: {e}")
            return False

    # ==================== æŸ¥è¯¢æ“ä½œ ====================

    async def get_top_recommendations(
        self,
        limit: int = 10,
        min_score: float = 7.0
    ) -> List[Dict[str, Any]]:
        """è·å–é«˜åˆ†æ¨èè‚¡ç¥¨"""
        query = """
            SELECT code, name, recommendation_score, recommendation_reason, created_at
            FROM stock_analysis_results
            WHERE recommendation_score >= $1
            ORDER BY recommendation_score DESC, created_at DESC
            LIMIT $2
        """
        async with self.pool.acquire() as conn:
            rows = await conn.fetch(query, min_score, limit)
            return [dict(row) for row in rows]

    async def get_analysis_by_code(self, code: str) -> Optional[Dict[str, Any]]:
        """è·å–æŒ‡å®šè‚¡ç¥¨çš„åˆ†æç»“æœ"""
        query = """
            SELECT *
            FROM stock_analysis_results
            WHERE code = $1
        """
        async with self.pool.acquire() as conn:
            row = await conn.fetchrow(query, code)
            if row:
                result = dict(row)
                # è§£æ JSONB
                if result.get('analysis_detail'):
                    result['analysis_detail'] = json.loads(result['analysis_detail'])
                return result
            return None
```

---

## 7. é…ç½®ç®¡ç†

### 7.1 ç¯å¢ƒå˜é‡é…ç½®

```bash
# .env.sample
# ==================== æ•°æ®åº“é…ç½® ====================
DB_HOST=172.29.128.1
DB_PORT=5432
DB_USER=postgres
DB_PASS=your_password
DB_NAME=fin_db

# ==================== LLM é…ç½® ====================
# OpenAI APIï¼ˆæ¨èç”¨äº Manager Agentï¼‰
OPENAI_API_KEY=sk-your-openai-api-key
OPENAI_BASE_URL=https://api.openai.com/v1
LLM_MODEL_MANAGER=gpt-4o              # Manager ä½¿ç”¨å¼ºæ¨¡å‹
LLM_MODEL_WORKER=gpt-4o-mini          # Worker ä½¿ç”¨è½»é‡æ¨¡å‹
TEMPERATURE_MANAGER=0.7               # Manager æ¨ç†æ¸©åº¦
TEMPERATURE_WORKER=0.3                # Worker æ¨ç†æ¸©åº¦

# DashScope APIï¼ˆé˜¿é‡Œäº‘ï¼Œå¯é€‰ï¼‰
DASHSCOPE_API_KEY=your_dashscope_api_key
DASHSCOPE_BASE_URL=https://dashscope.aliyuncs.com/compatible-mode/v1

# ==================== Web Search é…ç½® ====================
# Tavily APIï¼ˆæ¨èï¼‰
TAVILY_API_KEY=your_tavily_api_key

# Google Custom Searchï¼ˆå¯é€‰ï¼‰
GOOGLE_API_KEY=your_google_api_key
GOOGLE_CSE_ID=your_cse_id

# ==================== Magentic é…ç½® ====================
MAX_STALL_COUNT=3                     # æœ€å¤§åœæ»æ¬¡æ•°
MAX_RESET_COUNT=2                     # æœ€å¤§é‡ç½®æ¬¡æ•°
ENABLE_PLAN_REVIEW=true               # å¯ç”¨è®¡åˆ’å®¡æŸ¥
AUTO_APPROVE_PLAN=false               # è‡ªåŠ¨æ‰¹å‡†è®¡åˆ’ï¼ˆç”Ÿäº§ç¯å¢ƒå¯è®¾ä¸ºtrueï¼‰

# ==================== æ–‡ä»¶è·¯å¾„é…ç½® ====================
KLINE_IMAGE_DIR=/opt/fin_analysis/output  # Kçº¿å›¾PNGå­˜æ”¾ç›®å½•

# ==================== å¯è§‚æµ‹æ€§é…ç½®ï¼ˆå¯é€‰ï¼‰====================
ENABLE_TELEMETRY=false                # å¯ç”¨ OpenTelemetry
OTLP_ENDPOINT=http://localhost:4317   # OTLP å¯¼å‡ºç«¯ç‚¹

# ==================== æ—¥å¿—é…ç½® ====================
LOG_LEVEL=INFO                        # DEBUG/INFO/WARNING/ERROR
LOG_FILE=./logs/analysis_llm.log      # æ—¥å¿—æ–‡ä»¶è·¯å¾„
```

### 7.2 é…ç½®ç±»

```python
# config.py
from pydantic import Field
from pydantic_settings import BaseSettings
from typing import Optional

class Config(BaseSettings):
    """ç³»ç»Ÿé…ç½®"""

    # æ•°æ®åº“
    db_host: str = Field(default="localhost", alias="DB_HOST")
    db_port: int = Field(default=5432, alias="DB_PORT")
    db_user: str = Field(default="postgres", alias="DB_USER")
    db_pass: str = Field(default="", alias="DB_PASS")
    db_name: str = Field(default="fin_db", alias="DB_NAME")

    @property
    def database_dsn(self) -> str:
        return f"postgresql://{self.db_user}:{self.db_pass}@{self.db_host}:{self.db_port}/{self.db_name}"

    # LLM
    openai_api_key: str = Field(alias="OPENAI_API_KEY")
    openai_base_url: str = Field(default="https://api.openai.com/v1", alias="OPENAI_BASE_URL")
    llm_model_manager: str = Field(default="gpt-4o", alias="LLM_MODEL_MANAGER")
    llm_model_worker: str = Field(default="gpt-4o-mini", alias="LLM_MODEL_WORKER")
    temperature_manager: float = Field(default=0.7, alias="TEMPERATURE_MANAGER")
    temperature_worker: float = Field(default=0.3, alias="TEMPERATURE_WORKER")

    dashscope_api_key: Optional[str] = Field(default=None, alias="DASHSCOPE_API_KEY")
    dashscope_base_url: Optional[str] = Field(default=None, alias="DASHSCOPE_BASE_URL")

    # Web Search
    tavily_api_key: Optional[str] = Field(default=None, alias="TAVILY_API_KEY")
    google_api_key: Optional[str] = Field(default=None, alias="GOOGLE_API_KEY")
    google_cse_id: Optional[str] = Field(default=None, alias="GOOGLE_CSE_ID")

    @property
    def web_search_api_key(self) -> str:
        """ä¼˜å…ˆä½¿ç”¨ Tavilyï¼Œå…¶æ¬¡ Google"""
        if self.tavily_api_key:
            return self.tavily_api_key
        elif self.google_api_key:
            return self.google_api_key
        else:
            raise ValueError("æœªé…ç½® Web Search API Keyï¼ˆéœ€è¦ TAVILY_API_KEY æˆ– GOOGLE_API_KEYï¼‰")

    # Magentic
    max_stall_count: int = Field(default=3, alias="MAX_STALL_COUNT")
    max_reset_count: int = Field(default=2, alias="MAX_RESET_COUNT")
    enable_plan_review: bool = Field(default=True, alias="ENABLE_PLAN_REVIEW")
    auto_approve_plan: bool = Field(default=False, alias="AUTO_APPROVE_PLAN")

    # æ–‡ä»¶è·¯å¾„
    kline_image_dir: str = Field(default="./output", alias="KLINE_IMAGE_DIR")

    # å¯è§‚æµ‹æ€§
    enable_telemetry: bool = Field(default=False, alias="ENABLE_TELEMETRY")
    otlp_endpoint: str = Field(default="http://localhost:4317", alias="OTLP_ENDPOINT")

    # æ—¥å¿—
    log_level: str = Field(default="INFO", alias="LOG_LEVEL")
    log_file: str = Field(default="./logs/analysis_llm.log", alias="LOG_FILE")

    class Config:
        env_file = ".env"
        env_file_encoding = "utf-8"
        case_sensitive = False

    @classmethod
    def from_env(cls) -> "Config":
        """ä»ç¯å¢ƒå˜é‡åŠ è½½é…ç½®"""
        return cls()
```

---

## 8. éƒ¨ç½²ä¸ä½¿ç”¨

### 8.1 å®‰è£…ä¾èµ–

```bash
# å®‰è£… Python 3.12ï¼ˆå¦‚æœå°šæœªå®‰è£…ï¼‰
# Ubuntu/Debian:
sudo apt update
sudo apt install python3.12 python3.12-venv

# åˆ›å»ºé¡¹ç›®è™šæ‹Ÿç¯å¢ƒ
cd /opt/fin_analysis
python3.12 -m venv .venv
source .venv/bin/activate

# å®‰è£…ä¾èµ–
pip install --upgrade pip
pip install agent-framework==1.0.0b260130
pip install asyncpg pandas numpy pillow httpx python-dotenv pydantic pytest pytest-asyncio

# æˆ–ä½¿ç”¨ uvï¼ˆæ¨èï¼‰
pip install uv
uv pip install -r requirements.txt
```

### 8.2 åˆå§‹åŒ–æ•°æ®åº“

```bash
# è¿è¡Œæ•°æ®åº“åˆå§‹åŒ–è„šæœ¬
python -m analysis_llm.database.init_db
```

```python
# analysis_llm/database/init_db.py
import asyncio
from .connection import DatabaseManager
from ..config import Config

async def main():
    config = Config.from_env()
    db = DatabaseManager(config.database_dsn)
    await db.connect()

    # åˆ›å»º stock_analysis_results è¡¨
    create_table_sql = """
    CREATE TABLE IF NOT EXISTS stock_analysis_results (
        id SERIAL PRIMARY KEY,
        code VARCHAR(20) NOT NULL UNIQUE,
        name VARCHAR(100),
        recommendation_score NUMERIC(3,1) CHECK (recommendation_score >= 0 AND recommendation_score <= 10),
        recommendation_reason TEXT NOT NULL,
        sector_score NUMERIC(3,1),
        company_score NUMERIC(3,1),
        technical_score NUMERIC(3,1),
        analysis_detail JSONB,
        report_markdown TEXT,
        model_version VARCHAR(50) DEFAULT 'analysis_llm-v1.0-maf-b260130',
        created_at TIMESTAMP DEFAULT NOW(),
        updated_at TIMESTAMP DEFAULT NOW()
    );

    CREATE INDEX IF NOT EXISTS idx_analysis_score ON stock_analysis_results(recommendation_score DESC);
    CREATE INDEX IF NOT EXISTS idx_analysis_created_at ON stock_analysis_results(created_at DESC);
    """

    async with db.pool.acquire() as conn:
        await conn.execute(create_table_sql)

    print("âœ“ æ•°æ®åº“è¡¨åˆå§‹åŒ–å®Œæˆ")
    await db.close()

if __name__ == "__main__":
    asyncio.run(main())
```

### 8.3 ä½¿ç”¨ç¤ºä¾‹

#### åˆ†æå•æ”¯è‚¡ç¥¨
```bash
# æ–¹å¼1ï¼šå‘½ä»¤è¡ŒæŒ‡å®šè‚¡ç¥¨ä»£ç 
python -m analysis_llm 600000.SH

# æ–¹å¼2ï¼šäº¤äº’å¼é€‰æ‹©
python -m analysis_llm
```

```python
# analysis_llm/__main__.py
import asyncio
import sys
from .config import Config
from .analyzer import StockAnalyzer

async def main():
    # åŠ è½½é…ç½®
    config = Config.from_env()

    # åˆå§‹åŒ–åˆ†æå™¨
    analyzer = StockAnalyzer(config)
    await analyzer.initialize()

    # è·å–è‚¡ç¥¨ä»£ç 
    if len(sys.argv) > 1:
        stock_code = sys.argv[1]
    else:
        stock_code = input("è¯·è¾“å…¥è‚¡ç¥¨ä»£ç ï¼ˆå¦‚ 600000.SHï¼‰: ").strip()

    # æ‰§è¡Œåˆ†æ
    result = await analyzer.analyze_stock(stock_code)

    if result and result.get("success"):
        print(f"\nâœ“ åˆ†æå®Œæˆï¼ç»“æœå·²ä¿å­˜åˆ°æ•°æ®åº“ã€‚")
    else:
        print(f"\nâœ— åˆ†æå¤±è´¥")

    # æ¸…ç†èµ„æº
    await analyzer.close()

if __name__ == "__main__":
    asyncio.run(main())
```

#### æ‰¹é‡åˆ†æ
```python
# scripts/batch_analyze.py
import asyncio
from analysis_llm.config import Config
from analysis_llm.analyzer import StockAnalyzer
from analysis_llm.database import DatabaseManager

async def main():
    config = Config.from_env()
    db = DatabaseManager(config.database_dsn)
    await db.connect()

    # ä»æ•°æ®åº“è¯»å–å¾…åˆ†æè‚¡ç¥¨ï¼ˆscore >= 70 çš„å¹³åº•é”…å€™é€‰ï¼‰
    query = """
        SELECT code
        FROM stock_flatbottom_preselect
        WHERE score >= 70
        ORDER BY score DESC
        LIMIT 20
    """
    async with db.pool.acquire() as conn:
        rows = await conn.fetch(query)
        stock_codes = [row['code'] for row in rows]

    await db.close()

    # æ‰¹é‡åˆ†æ
    analyzer = StockAnalyzer(config)
    await analyzer.initialize()

    results = await analyzer.batch_analyze(stock_codes, delay_seconds=10)

    # ç»Ÿè®¡ç»“æœ
    success_count = sum(1 for r in results.values() if r and r.get("success"))
    print(f"\n{'='*60}")
    print(f"æ‰¹é‡åˆ†æå®Œæˆï¼šæˆåŠŸ {success_count}/{len(stock_codes)}")
    print(f"{'='*60}")

    await analyzer.close()

if __name__ == "__main__":
    asyncio.run(main())
```

#### æŸ¥çœ‹åˆ†æç»“æœ
```python
# scripts/view_results.py
import asyncio
from analysis_llm.config import Config
from analysis_llm.database import DatabaseManager

async def main():
    config = Config.from_env()
    db = DatabaseManager(config.database_dsn)
    await db.connect()

    # è·å– Top 10 æ¨è
    tops = await db.get_top_recommendations(limit=10, min_score=7.0)

    print("\n" + "="*80)
    print("ğŸ“Š Top æ¨èè‚¡ç¥¨ï¼ˆè¯„åˆ† â‰¥ 7.0ï¼‰")
    print("="*80)
    print(f"{'ä»£ç ':<15} {'åç§°':<20} {'è¯„åˆ†':<8} {'æ¨èç†ç”±'}")
    print("-"*80)

    for item in tops:
        print(f"{item['code']:<15} {item['name']:<20} {item['recommendation_score']:<8.1f} {item['recommendation_reason']}")

    print("="*80 + "\n")

    await db.close()

if __name__ == "__main__":
    asyncio.run(main())
```

---

## 9. ä¸å‚è€ƒè®¾è®¡çš„å¯¹æ¯”å’Œæ”¹è¿›

### 9.1 ä¸»è¦æ”¹è¿›ç‚¹

| ç»´åº¦ | å‚è€ƒè®¾è®¡ï¼ˆpython-1.0.0b260128ï¼‰ | æœ¬è®¾è®¡ï¼ˆpython-1.0.0b260130ï¼‰ |
|------|-------------------------------|------------------------------|
| **MAF ç‰ˆæœ¬** | python-1.0.0b260128 | **python-1.0.0b260130**ï¼ˆæœ€æ–°ï¼‰ |
| **ç±»å‹æç¤º** | åŸºç¡€ç±»å‹æç¤º | **æ³›å‹ç±»å‹æ”¯æŒ**ï¼ˆGeneric Type Parametersï¼‰ |
| **æ•°æ®åº“é›†æˆ** | ç®€å•ç¤ºä¾‹ | **å®Œæ•´çš„ DatabaseManager ç±»**ï¼Œæ”¯æŒè¿æ¥æ±  |
| **Web Search** | ç¤ºä¾‹ä»£ç  | **å®Œæ•´çš„ Tavily API å°è£…**ï¼Œæ”¯æŒå¤šç§å·¥å…· |
| **è¯„åˆ†ç®—æ³•** | ç®€å•åŠ æƒ | **ä¸‰ç»´è¯„åˆ†**ï¼ˆæ¿å—+å…¬å¸+æŠ€æœ¯ï¼‰+ è¯¦ç»†æƒé‡ |
| **æŠ¥å‘Šæ ¼å¼** | åŸºç¡€ Markdown | **ç»“æ„åŒ– Markdown**ï¼ŒåŒ…å«è¡¨æƒ…ç¬¦å·ã€å›¾è¡¨ã€è¯„åˆ†æ„æˆ |
| **æ•°æ®å­˜å‚¨** | ä»…å­˜è¯„åˆ†å’Œç†ç”± | **JSONB è¯¦ç»†æ•°æ®** + Markdown æŠ¥å‘Š |
| **æ‰¹é‡åˆ†æ** | ç®€å•å¾ªç¯ | **é™æµæ§åˆ¶**ï¼ˆdelay_secondsï¼‰+ é”™è¯¯å¤„ç† |
| **å¯è§‚æµ‹æ€§** | ç¤ºä¾‹é…ç½® | **é›†æˆåˆ°é…ç½®ç±»**ï¼Œæ˜“äºå¯ç”¨/ç¦ç”¨ |
| **æ–‡æ¡£å®Œæ•´æ€§** | è®¾è®¡æ–‡æ¡£ | **æ¦‚è¦è®¾è®¡ + å¿«é€Ÿå¼€å§‹ + éƒ¨ç½²æŒ‡å—** |

### 9.2 æ–°å¢ç‰¹æ€§

1. **å¤šæ¨¡æ€æ”¯æŒ**ï¼š
   - æ”¯æŒè¯»å– K çº¿å›¾ PNG æ–‡ä»¶ï¼ˆVision APIï¼‰
   - TechnicalAnalystAgent å¯ç›´æ¥åˆ†æå›¾åƒ

2. **é…ç½®ç®¡ç†ä¼˜åŒ–**ï¼š
   - ä½¿ç”¨ Pydantic Settings ç®¡ç†é…ç½®
   - æ”¯æŒ `.env` æ–‡ä»¶å’Œç¯å¢ƒå˜é‡
   - é…ç½®é¡¹åˆ†ç±»æ¸…æ™°ï¼ˆæ•°æ®åº“ã€LLMã€Web Searchã€Magenticï¼‰

3. **æ•°æ®åº“è®¾è®¡ä¼˜åŒ–**ï¼š
   - æ–°å¢åˆ†é¡¹è¯„åˆ†å­—æ®µï¼ˆsector_score, company_score, technical_scoreï¼‰
   - JSONB å­—æ®µå­˜å‚¨å®Œæ•´åˆ†ææ•°æ®ï¼Œä¾¿äºå›æº¯
   - æ·»åŠ æ¨¡å‹ç‰ˆæœ¬å­—æ®µï¼Œæ”¯æŒå¤šç‰ˆæœ¬å…±å­˜

4. **Web Search ç­–ç•¥**ï¼š
   - æ˜ç¡®æŸ¥è¯¢è¯è®¾è®¡åŸåˆ™
   - æœç´¢æ¬¡æ•°é™åˆ¶æœºåˆ¶
   - ç»“æœéªŒè¯å’Œäº¤å‰éªŒè¯

5. **é”™è¯¯å¤„ç†**ï¼š
   - æ•°æ®åº“è¿æ¥å¤±è´¥é‡è¯•
   - Agent è¾“å‡ºéªŒè¯
   - äººå·¥å¹²é¢„æœºåˆ¶ï¼ˆåœæ»æ£€æµ‹ï¼‰

### 9.3 å¾…ä¼˜åŒ–æ–¹å‘

1. **æ€§èƒ½ä¼˜åŒ–**ï¼š
   - å®ç° Agent ç»“æœç¼“å­˜ï¼ˆRedisï¼‰
   - æ¿å—ä¿¡æ¯ç¼“å­˜ï¼ˆé¿å…é‡å¤æœç´¢ï¼‰
   - å¹¶å‘æ‰¹é‡åˆ†æï¼ˆasyncio.gatherï¼‰

2. **æ¨¡å‹ä¼˜åŒ–**ï¼š
   - æ”¯æŒæ›´å¤š LLM æä¾›å•†ï¼ˆAzure OpenAIã€Geminiï¼‰
   - åŠ¨æ€æ¨¡å‹é€‰æ‹©ï¼ˆæ ¹æ®ä»»åŠ¡å¤æ‚åº¦ï¼‰
   - æˆæœ¬è·Ÿè¸ªå’Œä¼˜åŒ–

3. **åŠŸèƒ½æ‰©å±•**ï¼š
   - å¢åŠ  RiskAssessmentAgentï¼ˆé£é™©è¯„ä¼°ï¼‰
   - å¢åŠ  SentimentAnalysisAgentï¼ˆèˆ†æƒ…åˆ†æï¼‰
   - æ”¯æŒå®šæœŸé‡æ–°åˆ†æï¼ˆè¿½è¸ªè‚¡ç¥¨è¡¨ç°ï¼‰

4. **å·¥ç¨‹åŒ–**ï¼š
   - Docker å®¹å™¨åŒ–éƒ¨ç½²
   - CI/CD æµæ°´çº¿
   - ç›‘æ§å‘Šè­¦ç³»ç»Ÿ

---

## 10. æµ‹è¯•è®¡åˆ’

### 10.1 å•å…ƒæµ‹è¯•

```python
# tests/test_database.py
import pytest
from analysis_llm.database import DatabaseManager
from analysis_llm.config import Config

@pytest.mark.asyncio
async def test_get_stock_kline():
    config = Config.from_env()
    db = DatabaseManager(config.database_dsn)
    await db.connect()

    klines = await db.get_stock_kline("600000.SH", months=12)
    assert len(klines) > 0
    assert "close" in klines[0]

    await db.close()

@pytest.mark.asyncio
async def test_save_analysis_result():
    config = Config.from_env()
    db = DatabaseManager(config.database_dsn)
    await db.connect()

    success = await db.save_analysis_result(
        code="TEST.SH",
        name="æµ‹è¯•è‚¡ç¥¨",
        recommendation_score=8.5,
        recommendation_reason="æµ‹è¯•ç†ç”±",
        sector_score=8.0,
        company_score=9.0,
        technical_score=8.5,
        analysis_detail={"test": "data"},
        report_markdown="# æµ‹è¯•æŠ¥å‘Š"
    )

    assert success
    await db.close()
```

### 10.2 é›†æˆæµ‹è¯•

```python
# tests/test_workflow.py
import pytest
from analysis_llm.analyzer import StockAnalyzer
from analysis_llm.config import Config

@pytest.mark.asyncio
async def test_analyze_stock():
    config = Config.from_env()
    analyzer = StockAnalyzer(config)
    await analyzer.initialize()

    result = await analyzer.analyze_stock("600000.SH")

    assert result is not None
    assert result.get("success") == True

    await analyzer.close()
```

### 10.3 æµ‹è¯•æ¸…å•

- [ ] æ•°æ®åº“è¿æ¥æµ‹è¯•
- [ ] K çº¿æ•°æ®è¯»å–æµ‹è¯•
- [ ] Web Search å·¥å…·æµ‹è¯•
- [ ] Agent åˆ›å»ºæµ‹è¯•
- [ ] Workflow æ„å»ºæµ‹è¯•
- [ ] å•æ”¯è‚¡ç¥¨åˆ†æç«¯åˆ°ç«¯æµ‹è¯•
- [ ] æ‰¹é‡åˆ†ææµ‹è¯•
- [ ] é”™è¯¯å¤„ç†æµ‹è¯•ï¼ˆæ•°æ®ç¼ºå¤±ã€API è¶…æ—¶ç­‰ï¼‰
- [ ] äººå·¥å®¡æ‰¹æµç¨‹æµ‹è¯•

---

## 11. å¸¸è§é—®é¢˜ï¼ˆFAQï¼‰

### Q1: å¦‚ä½•æ›´æ¢ LLM æä¾›å•†ï¼Ÿ

**A**: ä¿®æ”¹ `.env` æ–‡ä»¶ä¸­çš„ API Key å’Œ Base URLï¼ŒMAF æ”¯æŒ OpenAI-compatible APIã€‚

```bash
# ä½¿ç”¨ DashScopeï¼ˆé˜¿é‡Œäº‘ï¼‰
OPENAI_API_KEY=your_dashscope_api_key
OPENAI_BASE_URL=https://dashscope.aliyuncs.com/compatible-mode/v1
LLM_MODEL_MANAGER=qwen-max
LLM_MODEL_WORKER=qwen-plus
```

### Q2: å¦‚ä½•ç¦ç”¨äººå·¥å®¡æ‰¹ï¼Ÿ

**A**: è®¾ç½® `.env` ä¸­çš„ `AUTO_APPROVE_PLAN=true`ï¼Œæˆ–åœ¨ä»£ç ä¸­ä¿®æ”¹ï¼š

```python
.with_plan_review(enable=False)
```

### Q3: å¦‚ä½•æ§åˆ¶æˆæœ¬ï¼Ÿ

**A**:
1. Manager ä½¿ç”¨ GPT-4oï¼ŒWorker ä½¿ç”¨ GPT-4o-mini
2. é™åˆ¶ Web Search æ¬¡æ•°ï¼ˆæ¯ä¸ª Agent æœ€å¤š 5 æ¬¡ï¼‰
3. ä½¿ç”¨ checkpointing é¿å…é‡å¤è®¡ç®—
4. æ‰¹é‡åˆ†ææ—¶å¢åŠ å»¶è¿Ÿï¼ˆdelay_secondsï¼‰

### Q4: å¦‚ä½•å¤„ç† API é™æµï¼Ÿ

**A**:
1. å¢åŠ  `delay_seconds`ï¼ˆæ‰¹é‡åˆ†ææ—¶ï¼‰
2. ä½¿ç”¨æŒ‡æ•°é€€é¿é‡è¯•ç­–ç•¥
3. é…ç½®å¤šä¸ª API Key è½®è¯¢ä½¿ç”¨

### Q5: å¦‚ä½•æŸ¥çœ‹è¯¦ç»†æ—¥å¿—ï¼Ÿ

**A**: è®¾ç½® `.env` ä¸­çš„ `LOG_LEVEL=DEBUG`

---

## 12. é™„å½•

### 12.1 å‚è€ƒèµ„æ–™

- [MAF å®˜æ–¹æ–‡æ¡£](https://learn.microsoft.com/en-us/agent-framework/)
- [Magentic ç¼–æ’æ–‡æ¡£](https://learn.microsoft.com/en-us/agent-framework/user-guide/workflows/orchestrations/magentic)
- [MAF GitHub Release python-1.0.0b260130](https://github.com/microsoft/agent-framework/releases/tag/python-1.0.0b260130)
- [Tavily API æ–‡æ¡£](https://docs.tavily.com/)
- [OpenAI GPT-4o æ–‡æ¡£](https://platform.openai.com/docs/models/gpt-4o)

### 12.2 é¡¹ç›®æ–‡ä»¶æ¸…å•

```
analysis_llm/
â”œâ”€â”€ __init__.py
â”œâ”€â”€ __main__.py                       # CLI å…¥å£
â”œâ”€â”€ config.py                         # é…ç½®ç®¡ç†
â”œâ”€â”€ analyzer.py                       # StockAnalyzer ä¸»ç±»
â”œâ”€â”€ agents/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ manager.py
â”‚   â”œâ”€â”€ stock_data_agent.py
â”‚   â”œâ”€â”€ sector_research_agent.py
â”‚   â”œâ”€â”€ company_research_agent.py
â”‚   â”œâ”€â”€ technical_analyst_agent.py
â”‚   â””â”€â”€ report_writer_agent.py
â”œâ”€â”€ tools/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ database_tools.py
â”‚   â”œâ”€â”€ web_search_tools.py
â”‚   â”œâ”€â”€ technical_tools.py
â”‚   â””â”€â”€ vision_tools.py
â”œâ”€â”€ models/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â””â”€â”€ schemas.py
â”œâ”€â”€ database/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ connection.py
â”‚   â”œâ”€â”€ queries.py
â”‚   â””â”€â”€ init_db.py
â””â”€â”€ utils/
    â”œâ”€â”€ __init__.py
    â”œâ”€â”€ logger.py
    â””â”€â”€ prompts.py

docs/analysis_llm/
â”œâ”€â”€ æ¦‚è¦è®¾è®¡æ–‡æ¡£.md                   # æœ¬æ–‡æ¡£
â”œâ”€â”€ APIæ–‡æ¡£.md                         # ï¼ˆå¾…ç¼–å†™ï¼‰
â””â”€â”€ éƒ¨ç½²æŒ‡å—.md                       # ï¼ˆå¾…ç¼–å†™ï¼‰

scripts/
â”œâ”€â”€ batch_analyze.py                  # æ‰¹é‡åˆ†æè„šæœ¬
â”œâ”€â”€ view_results.py                   # æŸ¥çœ‹ç»“æœè„šæœ¬
â””â”€â”€ test_single_agent.py              # å•Agentæµ‹è¯•è„šæœ¬

tests/
â”œâ”€â”€ test_database.py
â”œâ”€â”€ test_agents.py
â””â”€â”€ test_workflow.py
```

### 12.3 ç‰ˆæœ¬è§„åˆ’

| ç‰ˆæœ¬ | è®¡åˆ’åŠŸèƒ½ | é¢„è®¡æ—¶é—´ |
|------|---------|---------|
| v1.0 | åŸºç¡€å¤š Agent åˆ†æç³»ç»Ÿ | 2026-02-02 |
| v1.1 | å¢åŠ  RiskAssessmentAgent | 2026-02-15 |
| v1.2 | æ”¯æŒå®šæœŸé‡æ–°åˆ†æ | 2026-03-01 |
| v1.3 | å¢åŠ èˆ†æƒ…åˆ†æï¼ˆSentimentAgentï¼‰ | 2026-03-15 |
| v2.0 | ç”Ÿäº§çº§ä¼˜åŒ–ï¼ˆç¼“å­˜ã€ç›‘æ§ã€å®¹å™¨åŒ–ï¼‰ | 2026-04-01 |

---

## æ–‡æ¡£å˜æ›´è®°å½•

| æ—¥æœŸ | ç‰ˆæœ¬ | å˜æ›´å†…å®¹ | ä½œè€… |
|------|------|---------|------|
| 2026-02-02 | v1.0 | åˆå§‹ç‰ˆæœ¬ï¼Œå®Œæ•´æ¦‚è¦è®¾è®¡ | Claude |

---

**æ–‡æ¡£ç¼–å†™å®Œæˆæ—¶é—´**: 2026-02-02
**å®¡æ ¸çŠ¶æ€**: å¾…å®¡æ ¸
**ä¸‹ä¸€æ­¥è¡ŒåŠ¨**:
1. å®¡æ ¸æœ¬è®¾è®¡æ–‡æ¡£
2. å¼€å‘ analysis_llm æ¨¡å—ä»£ç 
3. ç¼–å†™å•å…ƒæµ‹è¯•
4. è¿›è¡Œç«¯åˆ°ç«¯æµ‹è¯•
5. ç¼–å†™éƒ¨ç½²æ–‡æ¡£
